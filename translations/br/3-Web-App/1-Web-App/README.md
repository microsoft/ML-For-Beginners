<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "e0b75f73e4a90d45181dc5581fe2ef5c",
  "translation_date": "2025-09-04T21:38:11+00:00",
  "source_file": "3-Web-App/1-Web-App/README.md",
  "language_code": "br"
}
-->
# Construa um Aplicativo Web para Usar um Modelo de ML

Nesta liÃ§Ã£o, vocÃª irÃ¡ treinar um modelo de ML em um conjunto de dados que Ã© fora deste mundo: _avistamentos de OVNIs ao longo do Ãºltimo sÃ©culo_, obtidos do banco de dados do NUFORC.

VocÃª aprenderÃ¡:

- Como 'pickle' um modelo treinado
- Como usar esse modelo em um aplicativo Flask

Continuaremos utilizando notebooks para limpar os dados e treinar nosso modelo, mas vocÃª pode levar o processo um passo adiante explorando o uso de um modelo "na prÃ¡tica", por assim dizer: em um aplicativo web.

Para fazer isso, vocÃª precisa construir um aplicativo web usando Flask.

## [Quiz prÃ©-aula](https://ff-quizzes.netlify.app/en/ml/)

## Construindo um aplicativo

Existem vÃ¡rias maneiras de construir aplicativos web para consumir modelos de aprendizado de mÃ¡quina. Sua arquitetura web pode influenciar a forma como seu modelo Ã© treinado. Imagine que vocÃª estÃ¡ trabalhando em uma empresa onde o grupo de ciÃªncia de dados treinou um modelo que eles querem que vocÃª use em um aplicativo.

### ConsideraÃ§Ãµes

HÃ¡ muitas perguntas que vocÃª precisa fazer:

- **Ã‰ um aplicativo web ou um aplicativo mÃ³vel?** Se vocÃª estÃ¡ construindo um aplicativo mÃ³vel ou precisa usar o modelo em um contexto de IoT, vocÃª pode usar [TensorFlow Lite](https://www.tensorflow.org/lite/) e utilizar o modelo em um aplicativo Android ou iOS.
- **Onde o modelo ficarÃ¡ armazenado?** Na nuvem ou localmente?
- **Suporte offline.** O aplicativo precisa funcionar offline?
- **Qual tecnologia foi usada para treinar o modelo?** A tecnologia escolhida pode influenciar as ferramentas que vocÃª precisa usar.
    - **Usando TensorFlow.** Se vocÃª estÃ¡ treinando um modelo usando TensorFlow, por exemplo, esse ecossistema oferece a capacidade de converter um modelo TensorFlow para uso em um aplicativo web usando [TensorFlow.js](https://www.tensorflow.org/js/).
    - **Usando PyTorch.** Se vocÃª estÃ¡ construindo um modelo usando uma biblioteca como [PyTorch](https://pytorch.org/), vocÃª tem a opÃ§Ã£o de exportÃ¡-lo no formato [ONNX](https://onnx.ai/) (Open Neural Network Exchange) para uso em aplicativos web JavaScript que podem usar o [Onnx Runtime](https://www.onnxruntime.ai/). Essa opÃ§Ã£o serÃ¡ explorada em uma liÃ§Ã£o futura para um modelo treinado com Scikit-learn.
    - **Usando Lobe.ai ou Azure Custom Vision.** Se vocÃª estÃ¡ usando um sistema de ML SaaS (Software como ServiÃ§o) como [Lobe.ai](https://lobe.ai/) ou [Azure Custom Vision](https://azure.microsoft.com/services/cognitive-services/custom-vision-service/?WT.mc_id=academic-77952-leestott) para treinar um modelo, esse tipo de software oferece maneiras de exportar o modelo para vÃ¡rias plataformas, incluindo a construÃ§Ã£o de uma API personalizada para ser consultada na nuvem pelo seu aplicativo online.

VocÃª tambÃ©m tem a oportunidade de construir um aplicativo web Flask completo que seria capaz de treinar o modelo diretamente em um navegador web. Isso tambÃ©m pode ser feito usando TensorFlow.js em um contexto JavaScript.

Para nossos propÃ³sitos, jÃ¡ que estamos trabalhando com notebooks baseados em Python, vamos explorar os passos necessÃ¡rios para exportar um modelo treinado de um notebook para um formato legÃ­vel por um aplicativo web construÃ­do em Python.

## Ferramenta

Para esta tarefa, vocÃª precisa de duas ferramentas: Flask e Pickle, ambas executadas em Python.

âœ… O que Ã© [Flask](https://palletsprojects.com/p/flask/)? Definido como um 'micro-framework' por seus criadores, Flask fornece os recursos bÃ¡sicos de frameworks web usando Python e um mecanismo de templates para construir pÃ¡ginas web. Confira [este mÃ³dulo de aprendizado](https://docs.microsoft.com/learn/modules/python-flask-build-ai-web-app?WT.mc_id=academic-77952-leestott) para praticar a construÃ§Ã£o com Flask.

âœ… O que Ã© [Pickle](https://docs.python.org/3/library/pickle.html)? Pickle ðŸ¥’ Ã© um mÃ³dulo Python que serializa e desserializa uma estrutura de objeto Python. Quando vocÃª 'pickle' um modelo, vocÃª serializa ou achata sua estrutura para uso na web. Cuidado: pickle nÃ£o Ã© intrinsecamente seguro, entÃ£o tenha cuidado se for solicitado a 'despickle' um arquivo. Um arquivo pickled tem o sufixo `.pkl`.

## ExercÃ­cio - limpe seus dados

Nesta liÃ§Ã£o, vocÃª usarÃ¡ dados de 80.000 avistamentos de OVNIs, coletados pelo [NUFORC](https://nuforc.org) (Centro Nacional de RelatÃ³rios de OVNIs). Esses dados tÃªm algumas descriÃ§Ãµes interessantes de avistamentos de OVNIs, por exemplo:

- **DescriÃ§Ã£o longa de exemplo.** "Um homem emerge de um feixe de luz que brilha em um campo gramado Ã  noite e corre em direÃ§Ã£o ao estacionamento da Texas Instruments".
- **DescriÃ§Ã£o curta de exemplo.** "as luzes nos perseguiram".

A planilha [ufos.csv](../../../../3-Web-App/1-Web-App/data/ufos.csv) inclui colunas sobre a `cidade`, `estado` e `paÃ­s` onde o avistamento ocorreu, o `formato` do objeto e sua `latitude` e `longitude`.

No [notebook](../../../../3-Web-App/1-Web-App/notebook.ipynb) em branco incluÃ­do nesta liÃ§Ã£o:

1. Importe `pandas`, `matplotlib` e `numpy` como vocÃª fez em liÃ§Ãµes anteriores e importe a planilha de OVNIs. VocÃª pode dar uma olhada em um conjunto de dados de amostra:

    ```python
    import pandas as pd
    import numpy as np
    
    ufos = pd.read_csv('./data/ufos.csv')
    ufos.head()
    ```

1. Converta os dados de OVNIs para um pequeno dataframe com tÃ­tulos novos. Verifique os valores Ãºnicos no campo `Country`.

    ```python
    ufos = pd.DataFrame({'Seconds': ufos['duration (seconds)'], 'Country': ufos['country'],'Latitude': ufos['latitude'],'Longitude': ufos['longitude']})
    
    ufos.Country.unique()
    ```

1. Agora, vocÃª pode reduzir a quantidade de dados com que precisamos lidar, descartando quaisquer valores nulos e importando apenas avistamentos entre 1-60 segundos:

    ```python
    ufos.dropna(inplace=True)
    
    ufos = ufos[(ufos['Seconds'] >= 1) & (ufos['Seconds'] <= 60)]
    
    ufos.info()
    ```

1. Importe a biblioteca `LabelEncoder` do Scikit-learn para converter os valores de texto dos paÃ­ses em nÃºmeros:

    âœ… LabelEncoder codifica dados alfabeticamente

    ```python
    from sklearn.preprocessing import LabelEncoder
    
    ufos['Country'] = LabelEncoder().fit_transform(ufos['Country'])
    
    ufos.head()
    ```

    Seus dados devem se parecer com isto:

    ```output
    	Seconds	Country	Latitude	Longitude
    2	20.0	3		53.200000	-2.916667
    3	20.0	4		28.978333	-96.645833
    14	30.0	4		35.823889	-80.253611
    23	60.0	4		45.582778	-122.352222
    24	3.0		3		51.783333	-0.783333
    ```

## ExercÃ­cio - construa seu modelo

Agora vocÃª pode se preparar para treinar um modelo dividindo os dados em grupos de treinamento e teste.

1. Selecione as trÃªs caracterÃ­sticas que vocÃª deseja treinar como seu vetor X, e o vetor y serÃ¡ o `Country`. VocÃª quer ser capaz de inserir `Seconds`, `Latitude` e `Longitude` e obter um id de paÃ­s como retorno.

    ```python
    from sklearn.model_selection import train_test_split
    
    Selected_features = ['Seconds','Latitude','Longitude']
    
    X = ufos[Selected_features]
    y = ufos['Country']
    
    X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=0)
    ```

1. Treine seu modelo usando regressÃ£o logÃ­stica:

    ```python
    from sklearn.metrics import accuracy_score, classification_report
    from sklearn.linear_model import LogisticRegression
    model = LogisticRegression()
    model.fit(X_train, y_train)
    predictions = model.predict(X_test)
    
    print(classification_report(y_test, predictions))
    print('Predicted labels: ', predictions)
    print('Accuracy: ', accuracy_score(y_test, predictions))
    ```

A precisÃ£o nÃ£o Ã© ruim **(cerca de 95%)**, o que nÃ£o Ã© surpreendente, jÃ¡ que `Country` e `Latitude/Longitude` estÃ£o correlacionados.

O modelo que vocÃª criou nÃ£o Ã© muito revolucionÃ¡rio, jÃ¡ que vocÃª deveria ser capaz de inferir um `Country` a partir de sua `Latitude` e `Longitude`, mas Ã© um bom exercÃ­cio para tentar treinar a partir de dados brutos que vocÃª limpou, exportou e depois usou esse modelo em um aplicativo web.

## ExercÃ­cio - 'pickle' seu modelo

Agora Ã© hora de _pickle_ seu modelo! VocÃª pode fazer isso em algumas linhas de cÃ³digo. Uma vez que ele esteja _pickled_, carregue seu modelo pickled e teste-o contra um array de dados de amostra contendo valores para segundos, latitude e longitude.

```python
import pickle
model_filename = 'ufo-model.pkl'
pickle.dump(model, open(model_filename,'wb'))

model = pickle.load(open('ufo-model.pkl','rb'))
print(model.predict([[50,44,-12]]))
```

O modelo retorna **'3'**, que Ã© o cÃ³digo do paÃ­s para o Reino Unido. IncrÃ­vel! ðŸ‘½

## ExercÃ­cio - construa um aplicativo Flask

Agora vocÃª pode construir um aplicativo Flask para chamar seu modelo e retornar resultados semelhantes, mas de uma maneira mais visualmente agradÃ¡vel.

1. Comece criando uma pasta chamada **web-app** ao lado do arquivo _notebook.ipynb_ onde seu arquivo _ufo-model.pkl_ estÃ¡ localizado.

1. Nessa pasta, crie mais trÃªs pastas: **static**, com uma pasta **css** dentro dela, e **templates**. VocÃª deve ter os seguintes arquivos e diretÃ³rios:

    ```output
    web-app/
      static/
        css/
      templates/
    notebook.ipynb
    ufo-model.pkl
    ```

    âœ… Consulte a pasta de soluÃ§Ã£o para ver o aplicativo finalizado

1. O primeiro arquivo a ser criado na pasta _web-app_ Ã© o arquivo **requirements.txt**. Como o _package.json_ em um aplicativo JavaScript, este arquivo lista as dependÃªncias necessÃ¡rias para o aplicativo. No **requirements.txt** adicione as linhas:

    ```text
    scikit-learn
    pandas
    numpy
    flask
    ```

1. Agora, execute este arquivo navegando atÃ© _web-app_:

    ```bash
    cd web-app
    ```

1. No seu terminal, digite `pip install` para instalar as bibliotecas listadas no _requirements.txt_:

    ```bash
    pip install -r requirements.txt
    ```

1. Agora, vocÃª estÃ¡ pronto para criar mais trÃªs arquivos para finalizar o aplicativo:

    1. Crie **app.py** na raiz.
    2. Crie **index.html** no diretÃ³rio _templates_.
    3. Crie **styles.css** no diretÃ³rio _static/css_.

1. Desenvolva o arquivo _styles.css_ com alguns estilos:

    ```css
    body {
    	width: 100%;
    	height: 100%;
    	font-family: 'Helvetica';
    	background: black;
    	color: #fff;
    	text-align: center;
    	letter-spacing: 1.4px;
    	font-size: 30px;
    }
    
    input {
    	min-width: 150px;
    }
    
    .grid {
    	width: 300px;
    	border: 1px solid #2d2d2d;
    	display: grid;
    	justify-content: center;
    	margin: 20px auto;
    }
    
    .box {
    	color: #fff;
    	background: #2d2d2d;
    	padding: 12px;
    	display: inline-block;
    }
    ```

1. Em seguida, desenvolva o arquivo _index.html_:

    ```html
    <!DOCTYPE html>
    <html>
      <head>
        <meta charset="UTF-8">
        <title>ðŸ›¸ UFO Appearance Prediction! ðŸ‘½</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
      </head>
    
      <body>
        <div class="grid">
    
          <div class="box">
    
            <p>According to the number of seconds, latitude and longitude, which country is likely to have reported seeing a UFO?</p>
    
            <form action="{{ url_for('predict')}}" method="post">
              <input type="number" name="seconds" placeholder="Seconds" required="required" min="0" max="60" />
              <input type="text" name="latitude" placeholder="Latitude" required="required" />
              <input type="text" name="longitude" placeholder="Longitude" required="required" />
              <button type="submit" class="btn">Predict country where the UFO is seen</button>
            </form>
    
            <p>{{ prediction_text }}</p>
    
          </div>
    
        </div>
    
      </body>
    </html>
    ```

    Observe o uso de templates neste arquivo. Note a sintaxe 'mustache' ao redor das variÃ¡veis que serÃ£o fornecidas pelo aplicativo, como o texto de previsÃ£o: `{{}}`. HÃ¡ tambÃ©m um formulÃ¡rio que envia uma previsÃ£o para a rota `/predict`.

    Finalmente, vocÃª estÃ¡ pronto para construir o arquivo Python que dirige o consumo do modelo e a exibiÃ§Ã£o das previsÃµes:

1. No `app.py` adicione:

    ```python
    import numpy as np
    from flask import Flask, request, render_template
    import pickle
    
    app = Flask(__name__)
    
    model = pickle.load(open("./ufo-model.pkl", "rb"))
    
    
    @app.route("/")
    def home():
        return render_template("index.html")
    
    
    @app.route("/predict", methods=["POST"])
    def predict():
    
        int_features = [int(x) for x in request.form.values()]
        final_features = [np.array(int_features)]
        prediction = model.predict(final_features)
    
        output = prediction[0]
    
        countries = ["Australia", "Canada", "Germany", "UK", "US"]
    
        return render_template(
            "index.html", prediction_text="Likely country: {}".format(countries[output])
        )
    
    
    if __name__ == "__main__":
        app.run(debug=True)
    ```

    > ðŸ’¡ Dica: quando vocÃª adiciona [`debug=True`](https://www.askpython.com/python-modules/flask/flask-debug-mode) ao executar o aplicativo web usando Flask, quaisquer alteraÃ§Ãµes feitas no seu aplicativo serÃ£o refletidas imediatamente sem a necessidade de reiniciar o servidor. AtenÃ§Ã£o! NÃ£o habilite este modo em um aplicativo de produÃ§Ã£o.

Se vocÃª executar `python app.py` ou `python3 app.py` - seu servidor web serÃ¡ iniciado localmente, e vocÃª poderÃ¡ preencher um formulÃ¡rio curto para obter uma resposta Ã  sua pergunta sobre onde os OVNIs foram avistados!

Antes de fazer isso, dÃª uma olhada nas partes do `app.py`:

1. Primeiro, as dependÃªncias sÃ£o carregadas e o aplicativo Ã© iniciado.
1. Em seguida, o modelo Ã© importado.
1. Depois, o index.html Ã© renderizado na rota inicial.

Na rota `/predict`, vÃ¡rias coisas acontecem quando o formulÃ¡rio Ã© enviado:

1. As variÃ¡veis do formulÃ¡rio sÃ£o coletadas e convertidas em um array numpy. Elas sÃ£o entÃ£o enviadas ao modelo e uma previsÃ£o Ã© retornada.
2. Os paÃ­ses que queremos exibir sÃ£o re-renderizados como texto legÃ­vel a partir de seu cÃ³digo de paÃ­s previsto, e esse valor Ã© enviado de volta ao index.html para ser renderizado no template.

Usar um modelo dessa forma, com Flask e um modelo pickled, Ã© relativamente simples. O mais difÃ­cil Ã© entender qual Ã© o formato dos dados que devem ser enviados ao modelo para obter uma previsÃ£o. Isso depende de como o modelo foi treinado. Este modelo requer trÃªs pontos de dados para ser inserido e obter uma previsÃ£o.

Em um ambiente profissional, vocÃª pode ver como Ã© importante ter uma boa comunicaÃ§Ã£o entre as pessoas que treinam o modelo e aquelas que o consomem em um aplicativo web ou mÃ³vel. No nosso caso, Ã© apenas uma pessoa: vocÃª!

---

## ðŸš€ Desafio

Em vez de trabalhar em um notebook e importar o modelo para o aplicativo Flask, vocÃª poderia treinar o modelo diretamente dentro do aplicativo Flask! Tente converter seu cÃ³digo Python no notebook, talvez apÃ³s limpar seus dados, para treinar o modelo dentro do aplicativo em uma rota chamada `train`. Quais sÃ£o os prÃ³s e contras de seguir esse mÃ©todo?

## [Quiz pÃ³s-aula](https://ff-quizzes.netlify.app/en/ml/)

## RevisÃ£o e Autoestudo

Existem muitas maneiras de construir um aplicativo web para consumir modelos de ML. FaÃ§a uma lista das maneiras que vocÃª poderia usar JavaScript ou Python para construir um aplicativo web que aproveite o aprendizado de mÃ¡quina. Considere a arquitetura: o modelo deve permanecer no aplicativo ou viver na nuvem? Se for o Ãºltimo caso, como vocÃª o acessaria? Desenhe um modelo arquitetural para uma soluÃ§Ã£o de ML aplicada em um aplicativo web.

## Tarefa

[Experimente um modelo diferente](assignment.md)

---

**Aviso Legal**:  
Este documento foi traduzido utilizando o serviÃ§o de traduÃ§Ã£o por IA [Co-op Translator](https://github.com/Azure/co-op-translator). Embora nos esforcemos para garantir a precisÃ£o, esteja ciente de que traduÃ§Ãµes automatizadas podem conter erros ou imprecisÃµes. O documento original em seu idioma nativo deve ser considerado a fonte autoritativa. Para informaÃ§Ãµes crÃ­ticas, recomenda-se a traduÃ§Ã£o profissional realizada por humanos. NÃ£o nos responsabilizamos por quaisquer mal-entendidos ou interpretaÃ§Ãµes equivocadas decorrentes do uso desta traduÃ§Ã£o.