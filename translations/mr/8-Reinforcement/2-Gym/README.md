<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "107d5bb29da8a562e7ae72262d251a75",
  "translation_date": "2025-09-06T06:19:34+00:00",
  "source_file": "8-Reinforcement/2-Gym/README.md",
  "language_code": "mr"
}
-->
## рдкреВрд░реНрд╡рдЕрдЯ

рдпрд╛ рдзрдбреНрдпрд╛рдд, рдЖрдореНрд╣реА **OpenAI Gym** рдирд╛рд╡рд╛рдЪреНрдпрд╛ рд▓рд╛рдпрдмреНрд░рд░реАрдЪрд╛ рд╡рд╛рдкрд░ рд╡рд┐рд╡рд┐рдз **рдкрд░рд┐рд╕рд░рд╛рдВрдЪреЗ** рдЕрдиреБрдХрд░рдг рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдХрд░рдгрд╛рд░ рдЖрд╣реЛрдд. рддреБрдореНрд╣реА рд╣рд╛ рдзрдбрд╛ рд╕реНрдерд╛рдирд┐рдХрд░рд┐рддреНрдпрд╛ (рдЙрджрд╛. Visual Studio Code рдордзреВрди) рдЪрд╛рд▓рд╡реВ рд╢рдХрддрд╛, рдЕрд╢рд╛ рд╡реЗрд│реА рдЕрдиреБрдХрд░рдг рдПрдХрд╛ рдирд╡реАрди рд╡рд┐рдВрдбреЛрдордзреНрдпреЗ рдЙрдШрдбреЗрд▓. рдСрдирд▓рд╛рдЗрди рдХреЛрдб рдЪрд╛рд▓рд╡рддрд╛рдирд╛, рддреБрдореНрд╣рд╛рд▓рд╛ рдХреЛрдбрдордзреНрдпреЗ рдХрд╛рд╣реА рдмрджрд▓ рдХрд░рд╛рд╡реЗ рд▓рд╛рдЧреВ рд╢рдХрддрд╛рдд, рдЬрд╕реЗ рдХреА [рдпреЗрдереЗ](https://towardsdatascience.com/rendering-openai-gym-envs-on-binder-and-google-colab-536f99391cc7) рд╡рд░реНрдгрди рдХреЗрд▓реЗ рдЖрд╣реЗ.

## OpenAI Gym

рдорд╛рдЧреАрд▓ рдзрдбреНрдпрд╛рдд, рдЦреЗрд│рд╛рдЪреЗ рдирд┐рдпрдо рдЖрдгрд┐ рд╕реНрдерд┐рддреА рдЖрдореНрд╣реА рд╕реНрд╡рддрдГ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХреЗрд▓реЗрд▓реНрдпрд╛ `Board` рд╡рд░реНрдЧрд╛рджреНрд╡рд╛рд░реЗ рджрд┐рд▓реЗ рд╣реЛрддреЗ. рдпреЗрдереЗ рдЖрдореНрд╣реА рдПрдХ рд╡рд┐рд╢реЗрд╖ **рдЕрдиреБрдХрд░рдг рд╡рд╛рддрд╛рд╡рд░рдг** рд╡рд╛рдкрд░рдгрд╛рд░ рдЖрд╣реЛрдд, рдЬреЗ рд╕рдВрддреБрд▓рди рд░рд╛рдЦрдгрд╛рд▒реНрдпрд╛ рдЦрд╛рдВрдмрд╛рдЪреНрдпрд╛ рднреМрддрд┐рдХрд╢рд╛рд╕реНрддреНрд░рд╛рдЪреЗ рдЕрдиреБрдХрд░рдг рдХрд░реЗрд▓. reinforcement learning рдЕрд▓реНрдЧреЛрд░рд┐рджрдо рдкреНрд░рд╢рд┐рдХреНрд╖рдгрд╛рд╕рд╛рдареА рд╕рд░реНрд╡рд╛рдд рд▓реЛрдХрдкреНрд░рд┐рдп рдЕрдиреБрдХрд░рдг рд╡рд╛рддрд╛рд╡рд░рдгрд╛рдВрдкреИрдХреА рдПрдХ [Gym](https://gym.openai.com/) рдЖрд╣реЗ, рдЬреЗ [OpenAI](https://openai.com/) рджреНрд╡рд╛рд░реЗ рджреЗрдЦрд░реЗрдЦ рдХреЗрд▓реА рдЬрд╛рддреЗ. рдпрд╛ рдЬрд┐рдордЪрд╛ рд╡рд╛рдкрд░ рдХрд░реВрди рдЖрдкрдг рд╡рд┐рд╡рд┐рдз **рдкрд░рд┐рд╕рд░** рддрдпрд╛рд░ рдХрд░реВ рд╢рдХрддреЛ, рдЬрд╕реЗ рдХреА cartpole рдЕрдиреБрдХрд░рдг рддреЗ Atari рдЧреЗрдореНрд╕.

> **рдЯреАрдк**: OpenAI Gym рдордзреАрд▓ рдЗрддрд░ рдЙрдкрд▓рдмреНрдз рд╡рд╛рддрд╛рд╡рд░рдг рддреБрдореНрд╣реА [рдпреЗрдереЗ](https://gym.openai.com/envs/#classic_control) рдкрд╛рд╣реВ рд╢рдХрддрд╛.

рд╕реБрд░реБрд╡рд╛рддреАрд▓рд╛, рдЬрд┐рдо рд╕реНрдерд╛рдкрд┐рдд рдХрд░реВрдпрд╛ рдЖрдгрд┐ рдЖрд╡рд╢реНрдпрдХ рд▓рд╛рдпрдмреНрд░рд░реА рдЖрдпрд╛рдд рдХрд░реВрдпрд╛ (рдХреЛрдб рдмреНрд▓реЙрдХ 1):

```python
import sys
!{sys.executable} -m pip install gym 

import gym
import matplotlib.pyplot as plt
import numpy as np
import random
```

## рд╡реНрдпрд╛рдпрд╛рдо - cartpole рд╡рд╛рддрд╛рд╡рд░рдг рдкреНрд░рд╛рд░рдВрдн рдХрд░рд╛

cartpole рд╕рдВрддреБрд▓рди рд╕рдорд╕реНрдпреЗрд╕реЛрдмрдд рдХрд╛рдо рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА, рдЖрдкрд▓реНрдпрд╛рд▓рд╛ рд╕рдВрдмрдВрдзрд┐рдд рд╡рд╛рддрд╛рд╡рд░рдг рдкреНрд░рд╛рд░рдВрдн рдХрд░рдгреЗ рдЖрд╡рд╢реНрдпрдХ рдЖрд╣реЗ. рдкреНрд░рддреНрдпреЗрдХ рд╡рд╛рддрд╛рд╡рд░рдгрд╛рд╢реА рд╕рдВрдмрдВрдзрд┐рдд рдЕрд╕рддреЗ:

- **Observation space** рдЬреЗ рдЖрдкрд▓реНрдпрд╛рд▓рд╛ рд╡рд╛рддрд╛рд╡рд░рдгрд╛рдХрдбреВрди рдорд┐рд│рдгрд╛рд▒реНрдпрд╛ рдорд╛рд╣рд┐рддреАрдЪреА рд░рдЪрдирд╛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ. cartpole рд╕рдорд╕реНрдпреЗрд╕рд╛рдареА, рдЖрдкрд▓реНрдпрд╛рд▓рд╛ рдЦрд╛рдВрдмрд╛рдЪреА рд╕реНрдерд┐рддреА, рд╡реЗрдЧ рдЖрдгрд┐ рдЗрддрд░ рдХрд╛рд╣реА рдореВрд▓реНрдпреЗ рдорд┐рд│рддрд╛рдд.

- **Action space** рдЬреЗ рд╕рдВрднрд╛рд╡реНрдп рдХреНрд░рд┐рдпрд╛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ. рдЖрдкрд▓реНрдпрд╛ рдкреНрд░рдХрд░рдгрд╛рдд action space discrete рдЖрд╣реЗ рдЖрдгрд┐ рджреЛрди рдХреНрд░рд┐рдпрд╛ рдЖрд╣реЗрдд - **рдбрд╛рд╡реАрдХрдбреЗ** рдЖрдгрд┐ **рдЙрдЬрд╡реАрдХрдбреЗ**. (рдХреЛрдб рдмреНрд▓реЙрдХ 2)

1. рдкреНрд░рд╛рд░рдВрдн рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА, рдЦрд╛рд▓реАрд▓ рдХреЛрдб рдЯрд╛рдЗрдк рдХрд░рд╛:

    ```python
    env = gym.make("CartPole-v1")
    print(env.action_space)
    print(env.observation_space)
    print(env.action_space.sample())
    ```

рд╡рд╛рддрд╛рд╡рд░рдг рдХрд╕реЗ рдХрд╛рд░реНрдп рдХрд░рддреЗ рд╣реЗ рдкрд╛рд╣рдгреНрдпрд╛рд╕рд╛рдареА, 100 рд╕реНрдЯреЗрдкреНрд╕рд╕рд╛рдареА рдПрдХ рд▓рд╣рд╛рди рдЕрдиреБрдХрд░рдг рдЪрд╛рд▓рд╡реВрдпрд╛. рдкреНрд░рддреНрдпреЗрдХ рд╕реНрдЯреЗрдкрд╡рд░, рдЖрдкрдг рдШреЗрдгреНрдпрд╛рдЪреА рдХреНрд░рд┐рдпрд╛ рдкреНрд░рджрд╛рди рдХрд░рддреЛ - рдпрд╛ рдЕрдиреБрдХрд░рдгрд╛рдд рдЖрдореНрд╣реА рдлрдХреНрдд `action_space` рдордзреВрди рдПрдХ рдХреНрд░рд┐рдпрд╛ рдирд┐рд╡рдбрддреЛ.

1. рдЦрд╛рд▓реАрд▓ рдХреЛрдб рдЪрд╛рд▓рд╡рд╛ рдЖрдгрд┐ рддреНрдпрд╛рдЪрд╛ рдкрд░рд┐рдгрд╛рдо рдкрд╣рд╛.

    тЬЕ рд▓рдХреНрд╖рд╛рдд рдареЗрд╡рд╛ рдХреА рд╣рд╛ рдХреЛрдб рд╕реНрдерд╛рдирд┐рдХ Python рдЗрдВрд╕реНрдЯреЙрд▓реЗрд╢рдирд╡рд░ рдЪрд╛рд▓рд╡рдгреЗ рдЕрдзрд┐рдХ рдЪрд╛рдВрдЧрд▓реЗ рдЖрд╣реЗ! (рдХреЛрдб рдмреНрд▓реЙрдХ 3)

    ```python
    env.reset()
    
    for i in range(100):
       env.render()
       env.step(env.action_space.sample())
    env.close()
    ```

    рддреБрдореНрд╣рд╛рд▓рд╛ рдЦрд╛рд▓реАрд▓ рдкреНрд░рддрд┐рдореЗрд╕рд╛рд░рдЦреЗ рдХрд╛рд╣реАрддрд░реА рджрд┐рд╕реЗрд▓:

    ![non-balancing cartpole](../../../../8-Reinforcement/2-Gym/images/cartpole-nobalance.gif)

1. рдЕрдиреБрдХрд░рдгрд╛рджрд░рдореНрдпрд╛рди, рдЖрдкрд▓реНрдпрд╛рд▓рд╛ рдирд┐рд░реНрдгрдп рдШреЗрдгреНрдпрд╛рд╕рд╛рдареА рдирд┐рд░реАрдХреНрд╖рдгреЗ рдорд┐рд│рд╡рдгреЗ рдЖрд╡рд╢реНрдпрдХ рдЖрд╣реЗ. рдкреНрд░рддреНрдпрдХреНрд╖рд╛рдд, `step` рдлрдВрдХреНрд╢рди рд╡рд░реНрддрдорд╛рди рдирд┐рд░реАрдХреНрд╖рдгреЗ, рдПрдХ reward рдлрдВрдХреНрд╢рди, рдЖрдгрд┐ done рдлреНрд▓реЕрдЧ рдкрд░рдд рдХрд░рддреЗ, рдЬреЗ рдЕрдиреБрдХрд░рдг рд╕реБрд░реВ рдареЗрд╡рдгреНрдпрд╛рд╕рд╛рд░рдЦреЗ рдЖрд╣реЗ рдХреА рдирд╛рд╣реА рд╣реЗ рд╕реВрдЪрд┐рдд рдХрд░рддреЗ: (рдХреЛрдб рдмреНрд▓реЙрдХ 4)

    ```python
    env.reset()
    
    done = False
    while not done:
       env.render()
       obs, rew, done, info = env.step(env.action_space.sample())
       print(f"{obs} -> {rew}")
    env.close()
    ```

    рддреБрдореНрд╣рд╛рд▓рд╛ рдиреЛрдЯрдмреБрдХ рдЖрдЙрдЯрдкреБрдЯрдордзреНрдпреЗ рдЕрд╕реЗ рдХрд╛рд╣реАрддрд░реА рджрд┐рд╕реЗрд▓:

    ```text
    [ 0.03403272 -0.24301182  0.02669811  0.2895829 ] -> 1.0
    [ 0.02917248 -0.04828055  0.03248977  0.00543839] -> 1.0
    [ 0.02820687  0.14636075  0.03259854 -0.27681916] -> 1.0
    [ 0.03113408  0.34100283  0.02706215 -0.55904489] -> 1.0
    [ 0.03795414  0.53573468  0.01588125 -0.84308041] -> 1.0
    ...
    [ 0.17299878  0.15868546 -0.20754175 -0.55975453] -> 1.0
    [ 0.17617249  0.35602306 -0.21873684 -0.90998894] -> 1.0
    ```

    рдЕрдиреБрдХрд░рдгрд╛рдЪреНрдпрд╛ рдкреНрд░рддреНрдпреЗрдХ рд╕реНрдЯреЗрдкрд╡рд░ рдкрд░рдд рдпреЗрдгрд╛рд░рд╛ observation рд╡реНрд╣реЗрдХреНрдЯрд░ рдЦрд╛рд▓реАрд▓ рдореВрд▓реНрдпреЗ рд╕рдорд╛рд╡рд┐рд╖реНрдЯ рдХрд░рддреЛ:
    - рдЧрд╛рдбреАрдЪреА рд╕реНрдерд┐рддреА
    - рдЧрд╛рдбреАрдЪрд╛ рд╡реЗрдЧ
    - рдЦрд╛рдВрдмрд╛рдЪрд╛ рдХреЛрди
    - рдЦрд╛рдВрдмрд╛рдЪрд╛ рдлрд┐рд░рдгреНрдпрд╛рдЪрд╛ рджрд░

1. рддреНрдпрд╛ рд╕рдВрдЦреНрдпрд╛рдВрдЪреЗ рдХрд┐рдорд╛рди рдЖрдгрд┐ рдЬрд╛рд╕реНрддреАрдд рдЬрд╛рд╕реНрдд рдореВрд▓реНрдп рдорд┐рд│рд╡рд╛: (рдХреЛрдб рдмреНрд▓реЙрдХ 5)

    ```python
    print(env.observation_space.low)
    print(env.observation_space.high)
    ```

    рддреБрдореНрд╣реА рд╣реЗ рджреЗрдЦреАрд▓ рд▓рдХреНрд╖рд╛рдд рдШреЗрдК рд╢рдХрддрд╛ рдХреА рдкреНрд░рддреНрдпреЗрдХ рдЕрдиреБрдХрд░рдг рд╕реНрдЯреЗрдкрд╡рд░реАрд▓ reward рдореВрд▓реНрдп рдиреЗрд╣рдореА 1 рдЕрд╕рддреЗ. рдХрд╛рд░рдг рдЖрдкрд▓реЗ рдзреНрдпреЗрдп рдЬрд╛рд╕реНрддреАрдд рдЬрд╛рд╕реНрдд рд╡реЗрд│ рдЯрд┐рдХреВрди рд░рд╛рд╣рдгреЗ рдЖрд╣реЗ, рдореНрд╣рдгрдЬреЗ рдЦрд╛рдВрдмрд╛рд▓рд╛ рд╢рдХреНрдп рддрд┐рддрдХреНрдпрд╛ рдЙрднреНрдпрд╛ рд╕реНрдерд┐рддреАрдд рдареЗрд╡рдгреЗ.

    тЬЕ рдкреНрд░рддреНрдпрдХреНрд╖рд╛рдд, CartPole рдЕрдиреБрдХрд░рдг рд╕реЛрдбрд╡рд▓реЗ рдЬрд╛рддреЗ рдЬрд░ рдЖрдкрдг 100 рд╕рд▓рдЧ рдЪрд╛рдЪрдгреНрдпрд╛рдВрдордзреНрдпреЗ 195 рдЪреНрдпрд╛ рд╕рд░рд╛рд╕рд░реА reward рдорд┐рд│рд╡реВ рд╢рдХрд▓реЛ.

## рд╕реНрдерд┐рддреАрдЪреЗ discretization

Q-Learning рдордзреНрдпреЗ, рдЖрдкрд▓реНрдпрд╛рд▓рд╛ Q-Table рддрдпрд╛рд░ рдХрд░рдгреЗ рдЖрд╡рд╢реНрдпрдХ рдЖрд╣реЗ рдЬреЗ рдкреНрд░рддреНрдпреЗрдХ рд╕реНрдерд┐рддреАрдд рдХрд╛рдп рдХрд░рд╛рд╡реЗ рд╣реЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ. рд╣реЗ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА, рд╕реНрдерд┐рддреА **discreet** рдЕрд╕рдгреЗ рдЖрд╡рд╢реНрдпрдХ рдЖрд╣реЗ, рдЕрдзрд┐рдХ рд╕реНрдкрд╖реНрдЯрдкрдгреЗ, рддреНрдпрд╛рдд рдорд░реНрдпрд╛рджрд┐рдд рд╕рдВрдЦреНрдпреЗрдиреЗ discrete рдореВрд▓реНрдпреЗ рдЕрд╕рд╛рд╡реАрдд. рдореНрд╣рдгреВрди, рдЖрдкрд▓реНрдпрд╛рд▓рд╛ рдХрд╛рд╣реАрддрд░реА рдХрд░реВрди рдЖрдкрд▓реА рдирд┐рд░реАрдХреНрд╖рдгреЗ **discretize** рдХрд░рдгреЗ рдЖрд╡рд╢реНрдпрдХ рдЖрд╣реЗ, рддреНрдпрд╛рдВрдирд╛ рдорд░реНрдпрд╛рджрд┐рдд рд╕реНрдерд┐рддреАрдВрдЪреНрдпрд╛ рд╕рдВрдЪрд╛рд╢реА рдирдХрд╛рд╢рд╛ рдХрд░рдгреЗ.

рд╣реЗ рдХрд░рдгреНрдпрд╛рдЪреЗ рдХрд╛рд╣реА рдорд╛рд░реНрдЧ рдЖрд╣реЗрдд:

- **Bins рдордзреНрдпреЗ рд╡рд┐рднрд╛рдЧрдгреЗ**. рдЬрд░ рдЖрдкрд▓реНрдпрд╛рд▓рд╛ рдПрдЦрд╛рджреНрдпрд╛ рдореВрд▓реНрдпрд╛рдЪрд╛ рдЕрдВрддрд░рд╛рд▓ рдорд╛рд╣рд┐рдд рдЕрд╕реЗрд▓, рддрд░ рдЖрдкрдг рдпрд╛ рдЕрдВрддрд░рд╛рд▓рд╛рд▓рд╛ рдХрд╛рд╣реА **bins** рдордзреНрдпреЗ рд╡рд┐рднрд╛рдЧреВ рд╢рдХрддреЛ рдЖрдгрд┐ рдирдВрддрд░ рддреНрдпрд╛ рдореВрд▓реНрдпрд╛рд▓рд╛ рддреНрдпрд╛рдЪреНрдпрд╛ bin рдХреНрд░рдорд╛рдВрдХрд╛рдиреЗ рдмрджрд▓реВ рд╢рдХрддреЛ. рд╣реЗ numpy рдЪреНрдпрд╛ [`digitize`](https://numpy.org/doc/stable/reference/generated/numpy.digitize.html) рдкрджреНрдзрддреАрдЪрд╛ рд╡рд╛рдкрд░ рдХрд░реВрди рдХреЗрд▓реЗ рдЬрд╛рдК рд╢рдХрддреЗ. рдпрд╛ рдкреНрд░рдХрд░рдгрд╛рдд, рдЖрдкрд▓реНрдпрд╛рд▓рд╛ рд╕реНрдерд┐рддреАрдЪрд╛ рдЖрдХрд╛рд░ рдЕрдЪреВрдХрдкрдгреЗ рдорд╛рд╣рд┐рдд рдЕрд╕реЗрд▓, рдХрд╛рд░рдг рддреЛ рдбрд┐рдЬрд┐рдЯрд▓рд╛рдпрдЭреЗрд╢рдирд╕рд╛рдареА рдирд┐рд╡рдбрд▓реЗрд▓реНрдпрд╛ bins рдЪреНрдпрд╛ рд╕рдВрдЦреНрдпреЗрд╡рд░ рдЕрд╡рд▓рдВрдмреВрди рдЕрд╕реЗрд▓.

тЬЕ рдЖрдкрдг linear interpolation рд╡рд╛рдкрд░реВрди рдореВрд▓реНрдпреЗ рдХрд╛рд╣реА рдорд░реНрдпрд╛рджрд┐рдд рдЕрдВрддрд░рд╛рд▓рд╛рдд (рдЙрджрд╛. -20 рддреЗ 20) рдЖрдгреВ рд╢рдХрддреЛ рдЖрдгрд┐ рдирдВрддрд░ rounding рдХрд░реВрди рд╕рдВрдЦреНрдпрд╛рдВрдирд╛ integers рдордзреНрдпреЗ рд░реВрдкрд╛рдВрддрд░рд┐рдд рдХрд░реВ рд╢рдХрддреЛ. рдпрд╛рдореБрд│реЗ рд╕реНрдерд┐рддреАрдЪреНрдпрд╛ рдЖрдХрд╛рд░рд╛рд╡рд░ рдереЛрдбреЗрд╕реЗ рдирд┐рдпрдВрддреНрд░рдг рдорд┐рд│рддреЗ, рд╡рд┐рд╢реЗрд╖рддрдГ рдЬрд░ рдЖрдкрд▓реНрдпрд╛рд▓рд╛ рдЗрдирдкреБрдЯ рдореВрд▓реНрдпрд╛рдВрдЪреНрдпрд╛ рдЕрдЪреВрдХ рд╢реНрд░реЗрдгреА рдорд╛рд╣рд┐рдд рдирд╕рддреАрд▓. рдЙрджрд╛рд╣рд░рдгрд╛рд░реНрде, рдЖрдкрд▓реНрдпрд╛ рдкреНрд░рдХрд░рдгрд╛рдд 4 рдкреИрдХреА 2 рдореВрд▓реНрдпреЗ рддреНрдпрд╛рдВрдЪреНрдпрд╛ рд╡рд░рдЪреНрдпрд╛/рдЦрд╛рд▓рдЪреНрдпрд╛ рдорд░реНрдпрд╛рджрд╛рдВрд╡рд░ рдорд░реНрдпрд╛рджрд┐рдд рдирд╛рд╣реАрдд, рдЬреНрдпрд╛рдореБрд│реЗ рд╕реНрдерд┐рддреАрдВрдЪреА рдЕрдорд░реНрдпрд╛рджрд┐рдд рд╕рдВрдЦреНрдпрд╛ рд╣реЛрдК рд╢рдХрддреЗ.

рдЖрдкрд▓реНрдпрд╛ рдЙрджрд╛рд╣рд░рдгрд╛рдд, рдЖрдкрдг рджреБрд╕рд▒реНрдпрд╛ рдкрджреНрдзрддреАрдЪрд╛ рд╡рд╛рдкрд░ рдХрд░реВ. рддреБрдореНрд╣реА рдирдВрддрд░ рд▓рдХреНрд╖рд╛рдд рдШреЗрдК рд╢рдХрддрд╛ рдХреА рдЕрдкрд░рд┐рднрд╛рд╖рд┐рдд рд╡рд░рдЪреНрдпрд╛/рдЦрд╛рд▓рдЪреНрдпрд╛ рдорд░реНрдпрд╛рджрд╛рдВрдирдВрддрд░рд╣реА, рддреА рдореВрд▓реНрдпреЗ рдХреНрд╡рдЪрд┐рддрдЪ рдХрд╛рд╣реА рдорд░реНрдпрд╛рджрд┐рдд рдЕрдВрддрд░рд╛рд▓рд╛рдЪреНрдпрд╛ рдмрд╛рд╣реЗрд░ рдЬрд╛рддрд╛рдд, рддреНрдпрд╛рдореБрд│реЗ рддреА рд╕реНрдерд┐рддреА рдЬреНрдпрд╛рдордзреНрдпреЗ extreme рдореВрд▓реНрдпреЗ рдЕрд╕рддрд╛рдд, рдлрд╛рд░рдЪ рджреБрд░реНрдорд┐рд│ рдЕрд╕рддреАрд▓.

1. рдпреЗрдереЗ рдПрдХ рдлрдВрдХреНрд╢рди рдЖрд╣реЗ рдЬреЗ рдЖрдкрд▓реНрдпрд╛ рдореЙрдбреЗрд▓рдордзреВрди рдирд┐рд░реАрдХреНрд╖рдг рдШреЗрдИрд▓ рдЖрдгрд┐ 4 integer рдореВрд▓реНрдпрд╛рдВрдЪреНрдпрд╛ tuple рддрдпрд╛рд░ рдХрд░реЗрд▓: (рдХреЛрдб рдмреНрд▓реЙрдХ 6)

    ```python
    def discretize(x):
        return tuple((x/np.array([0.25, 0.25, 0.01, 0.1])).astype(np.int))
    ```

1. рдЪрд▓рд╛ bins рд╡рд╛рдкрд░реВрди рджреБрд╕рд▒реНрдпрд╛ discretization рдкрджреНрдзрддреАрдЪрд╛ рд╢реЛрдз рдШреЗрдКрдпрд╛: (рдХреЛрдб рдмреНрд▓реЙрдХ 7)

    ```python
    def create_bins(i,num):
        return np.arange(num+1)*(i[1]-i[0])/num+i[0]
    
    print("Sample bins for interval (-5,5) with 10 bins\n",create_bins((-5,5),10))
    
    ints = [(-5,5),(-2,2),(-0.5,0.5),(-2,2)] # intervals of values for each parameter
    nbins = [20,20,10,10] # number of bins for each parameter
    bins = [create_bins(ints[i],nbins[i]) for i in range(4)]
    
    def discretize_bins(x):
        return tuple(np.digitize(x[i],bins[i]) for i in range(4))
    ```

1. рдЖрддрд╛ рдПрдХ рд▓рд╣рд╛рди рдЕрдиреБрдХрд░рдг рдЪрд╛рд▓рд╡реВрдпрд╛ рдЖрдгрд┐ рддреНрдпрд╛ discrete рд╡рд╛рддрд╛рд╡рд░рдг рдореВрд▓реНрдпрд╛рдВрдЪреЗ рдирд┐рд░реАрдХреНрд╖рдг рдХрд░реВрдпрд╛. `discretize` рдЖрдгрд┐ `discretize_bins` рджреЛрдиреНрд╣реА рд╡рд╛рдкрд░реВрди рдкрд╣рд╛ рдЖрдгрд┐ рдлрд░рдХ рдЖрд╣реЗ рдХрд╛ рддреЗ рдкрд╣рд╛.

    тЬЕ `discretize_bins` bin рдХреНрд░рдорд╛рдВрдХ рдкрд░рдд рдХрд░рддреЗ, рдЬреЗ 0-рдЖрдзрд╛рд░рд┐рдд рдЕрд╕рддреЗ. рддреНрдпрд╛рдореБрд│реЗ рдЗрдирдкреБрдЯ рд╡реНрд╣реЗрд░рд┐рдПрдмрд▓рдЪреНрдпрд╛ 0 рдЪреНрдпрд╛ рдЖрд╕рдкрд╛рд╕рдЪреНрдпрд╛ рдореВрд▓реНрдпрд╛рдВрд╕рд╛рдареА рддреЗ рдЕрдВрддрд░рд╛рд▓рд╛рдЪреНрдпрд╛ рдордзреНрдпрднрд╛рдЧреА рдЕрд╕рд▓реЗрд▓реЗ рдХреНрд░рдорд╛рдВрдХ (10) рдкрд░рдд рдХрд░рддреЗ. `discretize` рдордзреНрдпреЗ, рдЖрдореНрд╣реА рдЖрдЙрдЯрдкреБрдЯ рдореВрд▓реНрдпрд╛рдВрдЪреНрдпрд╛ рд╢реНрд░реЗрдгреАрдЪреА рдХрд╛рд│рдЬреА рдШреЗрддрд▓реА рдирд╛рд╣реА, рддреНрдпрд╛рдВрдирд╛ рдирдХрд╛рд░рд╛рддреНрдордХ рд╣реЛрдК рджрд┐рд▓реЗ, рддреНрдпрд╛рдореБрд│реЗ рд╕реНрдерд┐рддреА рдореВрд▓реНрдпреЗ shift рдЭрд╛рд▓реА рдирд╛рд╣реАрдд рдЖрдгрд┐ 0 рдореНрд╣рдгрдЬреЗ 0. (рдХреЛрдб рдмреНрд▓реЙрдХ 8)

    ```python
    env.reset()
    
    done = False
    while not done:
       #env.render()
       obs, rew, done, info = env.step(env.action_space.sample())
       #print(discretize_bins(obs))
       print(discretize(obs))
    env.close()
    ```

    тЬЕ `env.render` рд╕реБрд░реВ рдЕрд╕рд▓реЗрд▓реА рдУрд│ uncomment рдХрд░рд╛ рдЬрд░ рддреБрдореНрд╣рд╛рд▓рд╛ рд╡рд╛рддрд╛рд╡рд░рдг рдХрд╕реЗ рдХрд╛рд░реНрдп рдХрд░рддреЗ рддреЗ рдкрд╛рд╣рд╛рдпрдЪреЗ рдЕрд╕реЗрд▓. рдЕрдиреНрдпрдерд╛ рддреБрдореНрд╣реА рддреЗ background рдордзреНрдпреЗ рдЪрд╛рд▓рд╡реВ рд╢рдХрддрд╛, рдЬреЗ рдЬрд▓рдж рдЖрд╣реЗ. рдЖрдореНрд╣реА Q-Learning рдкреНрд░рдХреНрд░рд┐рдпреЗрджрд░рдореНрдпрд╛рди рдпрд╛ "рдЕрджреГрд╢реНрдп" рдЕрдВрдорд▓рдмрдЬрд╛рд╡рдгреАрдЪрд╛ рд╡рд╛рдкрд░ рдХрд░реВ.

## Q-Table рдЪреА рд░рдЪрдирд╛

рдорд╛рдЧреАрд▓ рдзрдбреНрдпрд╛рдд, рд╕реНрдерд┐рддреА 0 рддреЗ 8 рдкрд░реНрдпрдВрддрдЪреНрдпрд╛ рд╕рдВрдЦреНрдпрд╛рдВрдЪреНрдпрд╛ рд╕рд╛рдзреНрдпрд╛ рдЬреЛрдбреНрдпрд╛ рд╣реЛрддреА, рддреНрдпрд╛рдореБрд│реЗ Q-Table рд▓рд╛ numpy tensor рджреНрд╡рд╛рд░реЗ 8x8x2 рдЖрдХрд╛рд░рд╛рдиреЗ рджрд░реНрд╢рд╡рдгреЗ рд╕реЛрдпреАрдЪреЗ рд╣реЛрддреЗ. рдЬрд░ рдЖрдкрдг bins discretization рд╡рд╛рдкрд░рддреЛ, рддрд░ рдЖрдкрд▓реНрдпрд╛ рд╕реНрдерд┐рддреА рд╡реНрд╣реЗрдХреНрдЯрд░рдЪрд╛ рдЖрдХрд╛рд░ рджреЗрдЦреАрд▓ рдорд╛рд╣рд┐рдд рдЖрд╣реЗ, рддреНрдпрд╛рдореБрд│реЗ рдЖрдкрдг рд╕рдорд╛рди рджреГрд╖реНрдЯрд┐рдХреЛрди рд╡рд╛рдкрд░реВ рд╢рдХрддреЛ рдЖрдгрд┐ рд╕реНрдерд┐рддреАрд▓рд╛ 20x20x10x10x2 рдЖрдХрд╛рд░рд╛рдЪреНрдпрд╛ array рдиреЗ рджрд░реНрд╢рд╡реВ рд╢рдХрддреЛ (рдпреЗрдереЗ 2 рдореНрд╣рдгрдЬреЗ action space рдЪреЗ рдкрд░рд┐рдорд╛рдг рдЖрд╣реЗ, рдЖрдгрд┐ рдкрд╣рд┐рд▓реА рдкрд░рд┐рдорд╛рдгреЗ observation space рдордзреАрд▓ рдкреНрд░рддреНрдпреЗрдХ рдкреЕрд░рд╛рдореАрдЯрд░рд╕рд╛рдареА рдирд┐рд╡рдбрд▓реЗрд▓реНрдпрд╛ bins рдЪреНрдпрд╛ рд╕рдВрдЦреНрдпреЗрд╢реА рд╕рдВрдмрдВрдзрд┐рдд рдЖрд╣реЗрдд).

рддрдерд╛рдкрд┐, рдХрдзреАрдХрдзреА observation space рдЪреНрдпрд╛ рдЕрдЪреВрдХ рдкрд░рд┐рдорд╛рдгреЗ рдорд╛рд╣рд┐рдд рдирд╕рддрд╛рдд. `discretize` рдлрдВрдХреНрд╢рдирдЪреНрдпрд╛ рдмрд╛рдмрддреАрдд, рдЖрдкрд▓реНрдпрд╛рд▓рд╛ рдХрдзреАрд╣реА рдЦрд╛рддреНрд░реА рдирд╕рддреЗ рдХреА рдЖрдкрд▓реА рд╕реНрдерд┐рддреА рдХрд╛рд╣реА рдорд░реНрдпрд╛рджрд╛рдВрдордзреНрдпреЗ рд░рд╛рд╣рддреЗ, рдХрд╛рд░рдг рдХрд╛рд╣реА рдореВрд│ рдореВрд▓реНрдпреЗ рдорд░реНрдпрд╛рджрд┐рдд рдирд╛рд╣реАрдд. рддреНрдпрд╛рдореБрд│реЗ, рдЖрдореНрд╣реА рдереЛрдбрд╛ рд╡реЗрдЧрд│рд╛ рджреГрд╖реНрдЯрд┐рдХреЛрди рд╡рд╛рдкрд░реВ рдЖрдгрд┐ Q-Table рд▓рд╛ dictionary рджреНрд╡рд╛рд░реЗ рджрд░реНрд╢рд╡реВ.

1. *(state,action)* рдЬреЛрдбреНрдпрд╛рдЪрд╛ dictionary key рдореНрд╣рдгреВрди рд╡рд╛рдкрд░ рдХрд░рд╛, рдЖрдгрд┐ рдореВрд▓реНрдп Q-Table entry value рд╢реА рд╕рдВрдмрдВрдзрд┐рдд рдЕрд╕реЗрд▓. (рдХреЛрдб рдмреНрд▓реЙрдХ 9)

    ```python
    Q = {}
    actions = (0,1)
    
    def qvalues(state):
        return [Q.get((state,a),0) for a in actions]
    ```

    рдпреЗрдереЗ рдЖрдореНрд╣реА `qvalues()` рдирд╛рд╡рд╛рдЪреЗ рдлрдВрдХреНрд╢рди рджреЗрдЦреАрд▓ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЛ, рдЬреЗ рджрд┐рд▓реЗрд▓реНрдпрд╛ рд╕реНрдерд┐рддреАрд╕рд╛рдареА Q-Table рдореВрд▓реНрдпрд╛рдВрдЪреА рдпрд╛рджреА рдкрд░рдд рдХрд░рддреЗ рдЬреА рд╕рд░реНрд╡ рд╕рдВрднрд╛рд╡реНрдп рдХреНрд░рд┐рдпрд╛рдВрд╢реА рд╕рдВрдмрдВрдзрд┐рдд рдЕрд╕рддреЗ. рдЬрд░ entry Q-Table рдордзреНрдпреЗ рдЙрдкрд╕реНрдерд┐рдд рдирд╕реЗрд▓, рддрд░ рдЖрдореНрд╣реА default рдореНрд╣рдгреВрди 0 рдкрд░рдд рдХрд░реВ.

## рдЪрд▓рд╛ Q-Learning рд╕реБрд░реВ рдХрд░реВрдпрд╛

рдЖрддрд╛ рдЖрдкрдг рдкреАрдЯрд░рд▓рд╛ рд╕рдВрддреБрд▓рди рд╢рд┐рдХрд╡рдгреНрдпрд╛рд╕рд╛рдареА рддрдпрд╛рд░ рдЖрд╣реЛрдд!

1. рдкреНрд░рдердо, рдХрд╛рд╣реА hyperparameters рд╕реЗрдЯ рдХрд░реВрдпрд╛: (рдХреЛрдб рдмреНрд▓реЙрдХ 10)

    ```python
    # hyperparameters
    alpha = 0.3
    gamma = 0.9
    epsilon = 0.90
    ```

    рдпреЗрдереЗ, `alpha` рдореНрд╣рдгрдЬреЗ **learning rate** рдЬреЗ рдкреНрд░рддреНрдпреЗрдХ рд╕реНрдЯреЗрдкрд╡рд░ Q-Table рдЪреНрдпрд╛ рд╡рд░реНрддрдорд╛рди рдореВрд▓реНрдпрд╛рдВрдирд╛ рдХреЛрдгрддреНрдпрд╛ рдкреНрд░рдорд╛рдгрд╛рдд adjust рдХрд░рд╛рд╡реЗ рд╣реЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддреЗ. рдорд╛рдЧреАрд▓ рдзрдбреНрдпрд╛рдд рдЖрдкрдг 1 рдкрд╛рд╕реВрди рд╕реБрд░реБрд╡рд╛рдд рдХреЗрд▓реА рдЖрдгрд┐ рдирдВрддрд░ рдкреНрд░рд╢рд┐рдХреНрд╖рдгрд╛рджрд░рдореНрдпрд╛рди `alpha` рдХрдореА рдХреЗрд▓реЗ. рдпрд╛ рдЙрджрд╛рд╣рд░рдгрд╛рдд рдЖрдкрдг рд╕реЛрдкреЗрдкрдгрд╛рд╕рд╛рдареА рддреЗ рд╕реНрдерд┐рд░ рдареЗрд╡реВ рдЖрдгрд┐ рдирдВрддрд░ `alpha` рдореВрд▓реНрдпреЗ adjust рдХрд░рдгреНрдпрд╛рдЪрд╛ рдкреНрд░рдпреЛрдЧ рдХрд░реВ рд╢рдХрддрд╛.

    `gamma` рдореНрд╣рдгрдЬреЗ **discount factor** рдЬреЗ рднрд╡рд┐рд╖реНрдпрд╛рдЪреНрдпрд╛ reward рд▓рд╛ рд╡рд░реНрддрдорд╛рди reward рд╡рд░ рдХрд┐рддреА рдкреНрд░рдорд╛рдгрд╛рдд рдкреНрд░рд╛рдзрд╛рдиреНрдп рджреНрдпрд╛рд╡реЗ рд╣реЗ рджрд░реНрд╢рд╡рддреЗ.

    `epsilon` рдореНрд╣рдгрдЬреЗ **exploration/exploitation factor** рдЬреЗ рдард░рд╡рддреЗ рдХреА рдЖрдкрд▓реНрдпрд╛рд▓рд╛ exploration рд▓рд╛ рдкреНрд░рд╛рдзрд╛рдиреНрдп рджреНрдпрд╛рд╡реЗ рдХреА exploitation рд▓рд╛. рдЖрдкрд▓реНрдпрд╛ рдЕрд▓реНрдЧреЛрд░рд┐рджрдордордзреНрдпреЗ, рдЖрдореНрд╣реА `epsilon` рдЯрдХреНрдХреЗрд╡рд╛рд░реАрдЪреНрдпрд╛ рдкреНрд░рдХрд░рдгрд╛рдВрдордзреНрдпреЗ Q-Table рдореВрд▓реНрдпрд╛рдВрдиреБрд╕рд╛рд░ рдкреБрдвреАрд▓ рдХреНрд░рд┐рдпрд╛ рдирд┐рд╡рдбреВ, рдЖрдгрд┐ рдЙрд░реНрд╡рд░рд┐рдд рдкреНрд░рдХрд░рдгрд╛рдВрдордзреНрдпреЗ рдЖрдореНрд╣реА random рдХреНрд░рд┐рдпрд╛ execute рдХрд░реВ. рдпрд╛рдореБрд│реЗ рдЖрдкрд▓реНрдпрд╛рд▓рд╛ рд╢реЛрдз рд╕реНрдерд╛рдирд╛рдЪреНрдпрд╛ рдЕрд╢рд╛ рднрд╛рдЧрд╛рдВрдЪрд╛ рд╢реЛрдз рдШреЗрддрд╛ рдпреЗрдИрд▓ рдЬреЗ рдЖрдкрдг рдХрдзреАрд╣реА рдкрд╛рд╣рд┐рд▓реЗ рдирд╛рд╣реАрдд.

    тЬЕ рд╕рдВрддреБрд▓рдирд╛рдЪреНрдпрд╛ рдмрд╛рдмрддреАрдд - random рдХреНрд░рд┐рдпрд╛ (exploration) рдирд┐рд╡рдбрдгреЗ рдЪреБрдХреАрдЪреНрдпрд╛ рджрд┐рд╢реЗрдиреЗ random рдзрдХреНрдХрд╛ рджреЗрдгреНрдпрд╛рд╕рд╛рд░рдЦреЗ рдЕрд╕реЗрд▓, рдЖрдгрд┐ рдЦрд╛рдВрдмрд╛рдиреЗ рддреНрдпрд╛ "рдЪреБрдХрд╛" рдордзреВрди рд╕рдВрддреБрд▓рди рдХрд╕реЗ рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд рдХрд░рд╛рд╡реЗ рддреЗ рд╢рд┐рдХрд▓реЗ рдкрд╛рд╣рд┐рдЬреЗ.

### рдЕрд▓реНрдЧреЛрд░рд┐рджрдо рд╕реБрдзрд╛рд░рд┐рдд рдХрд░рд╛

рдЖрдкрд▓реНрдпрд╛ рдорд╛рдЧреАрд▓ рдзрдбреНрдпрд╛рддреАрд▓ рдЕрд▓реНрдЧреЛрд░рд┐рджрдордордзреНрдпреЗ рджреЛрди рд╕реБрдзрд╛рд░рдгрд╛ рдХрд░реВ рд╢рдХрддреЛ:

- **рд╕рд░рд╛рд╕рд░реА cumulative reward** рдЧрдгрдирд╛ рдХрд░рд╛, рдЕрдиреЗрдХ рдЕрдиреБрдХрд░рдгрд╛рдВрд╡рд░. рдЖрдореНрд╣реА рдкреНрд░рддреНрдпреЗрдХ 5000 iterations рд╡рд░ рдкреНрд░рдЧрддреА print рдХрд░реВ рдЖрдгрд┐ рддреНрдпрд╛ рдХрд╛рд▓рд╛рд╡рдзреАрддреАрд▓ cumulative reward рдЪреА рд╕рд░рд╛рд╕рд░реА рдХрд╛рдвреВ. рдпрд╛рдЪрд╛ рдЕрд░реНрде рдЕрд╕рд╛ рдХреА рдЬрд░ рдЖрдкрдг 195 рдкреЗрдХреНрд╖рд╛ рдЬрд╛рд╕реНрдд рдЧреБрдг рдорд┐рд│рд╡рд▓реЗ - рддрд░ рдЖрдкрдг рд╕рдорд╕реНрдпрд╛ рд╕реЛрдбрд╡рд▓реА рдЕрд╕реЗ рдорд╛рдиреВ рд╢рдХрддреЛ, рдЖрдгрд┐ рдЖрд╡рд╢реНрдпрдХрддреЗрдкреЗрдХреНрд╖рд╛ рдЙрдЪреНрдЪ рдЧреБрдгрд╡рддреНрддреЗрд╕рд╣.

- **рдЬрд╛рд╕реНрддреАрдд рдЬрд╛рд╕реНрдд рд╕рд░рд╛рд╕рд░реА cumulative рдкрд░рд┐рдгрд╛рдо** `Qmax` рдЧрдгрдирд╛ рдХрд░рд╛, рдЖрдгрд┐ рдЖрдореНрд╣реА рддреНрдпрд╛ рдкрд░рд┐рдгрд╛рдорд╛рд╢реА рд╕рдВрдмрдВрдзрд┐рдд Q-Table рд╕рд╛рдард╡реВ. рдЬреЗрд╡реНрд╣рд╛ рддреБрдореНрд╣реА рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдЪрд╛рд▓рд╡рддрд╛ рддреЗрд╡реНрд╣рд╛ рддреБрдореНрд╣рд╛рд▓рд╛ рд▓рдХреНрд╖рд╛рдд рдпреЗрдИрд▓ рдХреА рдХрдзреАрдХрдзреА рд╕рд░рд╛рд╕рд░реА cumulative рдкрд░рд┐рдгрд╛рдо рдХрдореА рд╣реЛрддреЛ, рдЖрдгрд┐ рдЖрдореНрд╣рд╛рд▓рд╛ рдкреНрд░рд╢рд┐рдХреНрд╖рдгрд╛рджрд░рдореНрдпрд╛рди рдкрд╛рд╣рд┐рд▓реЗрд▓реНрдпрд╛ рд╕рд░реНрд╡реЛрддреНрддрдо рдореЙрдбреЗрд▓рд╢реА рд╕рдВрдмрдВрдзрд┐рдд Q-Table рдЪреНрдпрд╛ рдореВрд▓реНрдпреЗ рдареЗрд╡рд╛рдпрдЪреА рдЖрд╣реЗрдд.

1. рдкреНрд░рддреНрдпреЗрдХ рдЕрдиреБрдХрд░рдгрд╛рдЪреНрдпрд╛ cumulative rewards `rewards` рд╡реНрд╣реЗрдХреНрдЯрд░рдордзреНрдпреЗ рдЧреЛрд│рд╛ рдХрд░рд╛ рдЬреЗрдгреЗрдХрд░реВрди рдирдВрддрд░ plotting рдХрд░рддрд╛ рдпреЗрдИрд▓. (рдХреЛрдб рдмреНрд▓реЙрдХ 11)

    ```python
    def probs(v,eps=1e-4):
        v = v-v.min()+eps
        v = v/v.sum()
        return v
    
    Qmax = 0
    cum_rewards = []
    rewards = []
    for epoch in range(100000):
        obs = env.reset()
        done = False
        cum_reward=0
        # == do the simulation ==
        while not done:
            s = discretize(obs)
            if random.random()<epsilon:
                # exploitation - chose the action according to Q-Table probabilities
                v = probs(np.array(qvalues(s)))
                a = random.choices(actions,weights=v)[0]
            else:
                # exploration - randomly chose the action
                a = np.random.randint(env.action_space.n)
    
            obs, rew, done, info = env.step(a)
            cum_reward+=rew
            ns = discretize(obs)
            Q[(s,a)] = (1 - alpha) * Q.get((s,a),0) + alpha * (rew + gamma * max(qvalues(ns)))
        cum_rewards.append(cum_reward)
        rewards.append(cum_reward)
        # == Periodically print results and calculate average reward ==
        if epoch%5000==0:
            print(f"{epoch}: {np.average(cum_rewards)}, alpha={alpha}, epsilon={epsilon}")
            if np.average(cum_rewards) > Qmax:
                Qmax = np.average(cum_rewards)
                Qbest = Q
            cum_rewards=[]
    ```

рддреБрдореНрд╣реА рдпрд╛ рдкрд░рд┐рдгрд╛рдорд╛рдВрдордзреВрди рдХрд╛рдп рд▓рдХреНрд╖рд╛рдд рдШреЗрдК рд╢рдХрддрд╛:

- **рдЖрдкрд▓реНрдпрд╛ рдзреНрдпреЗрдпрд╛рдЪреНрдпрд╛ рдЬрд╡рд│**. рдЖрдореНрд╣реА 100+ рд╕рд▓рдЧ рдЕрдиреБрдХрд░рдгрд╛рдВрдЪреНрдпрд╛ рд╕рд░рд╛рд╕рд░реА 195 cumulative rewards рдорд┐рд│рд╡рдгреНрдпрд╛рдЪреНрдпрд╛ рдзреНрдпреЗрдпрд╛рдЪреНрдпрд╛ рдЦреВрдк рдЬрд╡рд│ рдЖрд╣реЛрдд, рдХрд┐рдВрд╡рд╛ рдЖрдореНрд╣реА рдкреНрд░рддреНрдпрдХреНрд╖рд╛рдд рддреЗ рд╕рд╛рдзреНрдп рдХреЗрд▓реЗ рдЕрд╕реЗрд▓! рдЬрд░реА рдЖрдореНрд╣рд╛рд▓рд╛ рдХрдореА рд╕рдВрдЦреНрдпрд╛ рдорд┐рд│рд╛рд▓реНрдпрд╛ рддрд░реА, рдЖрдореНрд╣рд╛рд▓рд╛ рдорд╛рд╣рд┐рдд рдирд╛рд╣реА, рдХрд╛рд░рдг рдЖрдореНрд╣реА 5000 runs рд╡рд░ рд╕рд░рд╛рд╕рд░реА рдХрд╛рдврддреЛ, рдЖрдгрд┐ рдФрдкрдЪрд╛рд░рд┐рдХ рдирд┐рдХрд╖рд╛рдВрдордзреНрдпреЗ рдлрдХреНрдд 100 runs рдЖрд╡рд╢реНрдпрдХ рдЖрд╣реЗрдд.

- **Reward рдХрдореА рд╣реЛрддреЛ**. рдХрдзреАрдХрдзреА reward рдХрдореА рд╣реЛрддреЛ, рдпрд╛рдЪрд╛ рдЕрд░реНрде рдЕрд╕рд╛ рдХреА рдЖрдкрдг Q-Table рдордзреНрдпреЗ рдЖрдзреА рд╢рд┐рдХрд▓реЗрд▓реНрдпрд╛ рдореВрд▓реНрдпрд╛рдВрдирд╛ "рдирд╖реНрдЯ" рдХрд░реВ рд╢рдХрддреЛ рдЖрдгрд┐ рдкрд░рд┐рд╕реНрдерд┐рддреА рдЕрдзрд┐рдХ рд╡рд╛рдИрдЯ рдмрдирд╡рдгрд╛рд▒реНрдпрд╛ рдирд╡реАрди рдореВрд▓реНрдпрд╛рдВрд╕рд╣ рдмрджрд▓реВ рд╢рдХрддреЛ.

рд╣реЗ рдирд┐рд░реАрдХреНрд╖рдг рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдкреНрд░рдЧрддреА plot рдХреЗрд▓реНрдпрд╛рд╡рд░ рдЕрдзрд┐рдХ рд╕реНрдкрд╖реНрдЯрдкрдгреЗ рджрд┐рд╕рддреЗ.

## рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдкреНрд░рдЧрддреАрдЪреЗ plotting

рдкреНрд░рд╢рд┐рдХреНрд╖рдгрд╛рджрд░рдореНрдпрд╛рди, рдЖрдореНрд╣реА рдкреНрд░рддреНрдпреЗрдХ iteration рд╡рд░ cumulative reward рдореВрд▓реНрдп `rewards` рд╡реНрд╣реЗрдХреНрдЯрд░рдордзреНрдпреЗ рдЧреЛрд│рд╛ рдХреЗрд▓реЗ рдЖрд╣реЗ. рдЬреЗрд╡реНрд╣рд╛ рдЖрдкрдг рддреЗ iteration рдХреНрд░рдорд╛рдВрдХрд╛рдЪреНрдпрд╛ рд╡рд┐рд░реЛрдзрд╛рдд plot рдХрд░рддреЛ рддреЗрд╡реНрд╣рд╛ рддреЗ рдЕрд╕реЗ рджрд┐рд╕рддреЗ:

```python
plt.plot(rewards)
```

![raw progress](../../../../8-Reinforcement/2-Gym/images/train_progress_raw.png)

рдпрд╛ graph рд╡рд░реВрди рдХрд╛рд╣реАрд╣реА рд╕рд╛рдВрдЧрдгреЗ рд╢рдХреНрдп рдирд╛рд╣реА, рдХрд╛рд░рдг stochastic рдкреНрд░рд╢рд┐рдХреНрд╖рдг рдкреНрд░рдХреНрд░рд┐рдпреЗрдЪреНрдпрд╛ рд╕реНрд╡рд░реВрдкрд╛рдореБрд│реЗ рдкреНрд░рд╢рд┐рдХреНрд╖рдг рд╕рддреНрд░рд╛рдВрдЪреА рд▓рд╛рдВрдмреА рдЦреВрдк рд╡реЗрдЧрд│реА рдЕрд╕рддреЗ. рдпрд╛ graph рд▓рд╛ рдЕрдзрд┐рдХ рдЕрд░реНрдердкреВрд░реНрдг рдмрдирд╡рдгреНрдпрд╛рд╕рд╛рдареА, рдЖрдкрдг 100 рдЪрд╛рдЪрдгреНрдпрд╛рдВрд╡рд░ **running average** рдЧрдгрдирд╛ рдХрд░реВ рд╢рдХрддреЛ. рд╣реЗ `np.convolve` рд╡рд╛рдкрд░реВрди рд╕реЛрдпреАрд╕реНрдХрд░рдкрдгреЗ рдХреЗрд▓реЗ рдЬрд╛рдК рд╢рдХрддреЗ: (рдХреЛрдб рдмреНрд▓реЙрдХ 12)

```python
def running_average(x,window):
    return np.convolve(x,np.ones(window)/window,mode='valid')

plt.plot(running_average(rewards,100))
```

![training progress](../../../../8-Reinforcement/2-Gym/images/train_progress_runav.png)

## hyperparameters рдмрджрд▓рдгреЗ

рд╢рд┐рдХрдгреЗ рдЕрдзрд┐рдХ рд╕реНрдерд┐рд░ рдмрдирд╡рдгреНрдпрд╛рд╕рд╛рдареА, рдкреНрд░рд╢рд┐рдХреНрд╖рдгрд╛рджрд░рдореНрдпрд╛рди рдХрд╛рд╣реА hyperparameters adjust рдХрд░рдгреЗ рдпреЛрдЧреНрдп рдард░реЗрд▓. рд╡рд┐рд╢реЗрд╖рддрдГ:

- **Learning rate** `alpha` рд╕рд╛рдареА, рдЖрдкрдг 1 рдЪреНрдпрд╛ рдЬрд╡рд│рдкрд╛рд╕рдЪреНрдпрд╛ рдореВрд▓реНрдпрд╛рдВрдкрд╛рд╕реВрди рд╕реБрд░реБрд╡рд╛рдд рдХрд░реВ рд╢рдХрддреЛ рдЖрдгрд┐ рдирдВрддрд░ рд╣рд╛ parameter рдХрдореА рдХрд░рдд рд░рд╛рд╣реВ рд╢рдХрддреЛ. рдХрд╛рд▓рд╛рдВрддрд░рд╛рдиреЗ, рдЖрдкрд▓реНрдпрд╛рд▓рд╛ Q-Table рдордзреНрдпреЗ рдЪрд╛рдВрдЧрд▓реЗ probability рдореВрд▓реНрдпреЗ рдорд┐рд│рддреАрд▓, рдЖрдгрд┐ рддреНрдпрд╛рдореБрд│реЗ рдЖрдкрдг рддреНрдпрд╛рдВрдирд╛ рдереЛрдбреЗ adjust рдХрд░рд╛рд╡реЗ, рдЖрдгрд┐ рдирд╡реАрди рдореВрд▓реНрдпрд╛рдВрд╕рд╣ рдкреВрд░реНрдгрдкрдгреЗ overwrite рдХрд░реВ рдирдпреЗ.

- **epsilon рд╡рд╛рдврд╡рд╛**. рдЖрдкрдг `epsilon` рд╣рд│реВрд╣рд│реВ рд╡рд╛рдврд╡реВ рдЗрдЪреНрдЫрд┐рддреЛ, рдЬреЗрдгреЗрдХрд░реВрди рдХрдореА рд╢реЛрдз рдШреЗрдКрди рдЕрдзрд┐рдХ exploitation рдХрд░реВ рд╢рдХрддреЛ. рдХрджрд╛рдЪрд┐рдд рдХрдореА `epsilon` рдореВрд▓реНрдпрд╛рдиреЗ рд╕реБрд░реБрд╡рд╛рдд рдХрд░рдгреЗ рдЖрдгрд┐ рдЬрд╡рд│рдЬрд╡рд│ 1 рдкрд░реНрдпрдВрдд рдЬрд╛рдгреЗ рдпреЛрдЧреНрдп рдард░реЗрд▓.
> **рдХрд╛рд░реНрдп 1**: рд╣рд╛рдпрдкрд░рдкреЕрд░рд╛рдорд┐рдЯрд░рдЪреНрдпрд╛ рдореВрд▓реНрдпрд╛рдВрд╢реА рдкреНрд░рдпреЛрдЧ рдХрд░рд╛ рдЖрдгрд┐ рдкрд╛рд╣рд╛ рдХреА рддреБрдореНрд╣реА рдЬрд╛рд╕реНрдд рдПрдХрддреНрд░рд┐рдд рдмрдХреНрд╖реАрд╕ рдорд┐рд│рд╡реВ рд╢рдХрддрд╛ рдХрд╛. рддреБрдореНрд╣рд╛рд▓рд╛ 195 рдкреЗрдХреНрд╖рд╛ рдЬрд╛рд╕реНрдд рдорд┐рд│рдд рдЖрд╣реЗ рдХрд╛?
> **рдХрд╛рд░реНрдп 2**: рд╕рдорд╕реНрдпрд╛ рдФрдкрдЪрд╛рд░рд┐рдХрдкрдгреЗ рд╕реЛрдбрд╡рдгреНрдпрд╛рд╕рд╛рдареА, рддреБрдореНрд╣рд╛рд▓рд╛ 100 рд╕рд▓рдЧ рдзрд╛рд╡рд╛рдВрдордзреНрдпреЗ 195 рд╕рд░рд╛рд╕рд░реА рдмрдХреНрд╖реАрд╕ рдорд┐рд│рд╡рдгреЗ рдЖрд╡рд╢реНрдпрдХ рдЖрд╣реЗ. рдкреНрд░рд╢рд┐рдХреНрд╖рдгрд╛рджрд░рдореНрдпрд╛рди рддреЗ рдореЛрдЬрд╛ рдЖрдгрд┐ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рд╛ рдХреА рддреБрдореНрд╣реА рд╕рдорд╕реНрдпрд╛ рдФрдкрдЪрд╛рд░рд┐рдХрдкрдгреЗ рд╕реЛрдбрд╡рд▓реА рдЖрд╣реЗ!

## рдкрд░рд┐рдгрд╛рдо рдкреНрд░рддреНрдпрдХреНрд╖рд╛рдд рдкрд╛рд╣рдгреЗ

рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдореЙрдбреЗрд▓ рдХрд╕реЗ рд╡рд╛рдЧрддреЗ рд╣реЗ рдкреНрд░рддреНрдпрдХреНрд╖рд╛рдд рдкрд╛рд╣рдгреЗ рдордиреЛрд░рдВрдЬрдХ рдард░реЗрд▓. рдЪрд▓рд╛ рд╕рд┐рдореНрдпреБрд▓реЗрд╢рди рдЪрд╛рд▓рд╡реВрдпрд╛ рдЖрдгрд┐ рдкреНрд░рд╢рд┐рдХреНрд╖рдгрд╛рджрд░рдореНрдпрд╛рди рд╡рд╛рдкрд░рд▓реЗрд▓реНрдпрд╛ рд╕рдорд╛рди рдХреГрддреА рдирд┐рд╡рдбрдгреНрдпрд╛рдЪреНрдпрд╛ рд░рдгрдиреАрддреАрдЪреЗ рдЕрдиреБрд╕рд░рдг рдХрд░реВрдпрд╛, Q-Table рдордзреАрд▓ рд╕рдВрднрд╛рд╡реНрдпрддрд╛ рд╡рд┐рддрд░рдгрд╛рдиреБрд╕рд╛рд░ рдирдореБрдирд╛ рдШреЗрдКрдпрд╛: (рдХреЛрдб рдмреНрд▓реЙрдХ 13)

```python
obs = env.reset()
done = False
while not done:
   s = discretize(obs)
   env.render()
   v = probs(np.array(qvalues(s)))
   a = random.choices(actions,weights=v)[0]
   obs,_,done,_ = env.step(a)
env.close()
```

рддреБрдореНрд╣рд╛рд▓рд╛ рдЕрд╕реЗ рдХрд╛рд╣реАрддрд░реА рджрд┐рд╕реЗрд▓:

![рдПрдХ рд╕рдВрддреБрд▓рд┐рдд рдХрд╛рд░реНрдЯрдкреЛрд▓](../../../../8-Reinforcement/2-Gym/images/cartpole-balance.gif)

---

## ЁЯЪАрдЪреЕрд▓реЗрдВрдЬ

> **рдХрд╛рд░реНрдп 3**: рдпреЗрдереЗ, рдЖрдореНрд╣реА Q-Table рдЪреА рдЕрдВрддрд┐рдо рдкреНрд░рдд рд╡рд╛рдкрд░рдд рд╣реЛрддреЛ, рдЬреА рдХрджрд╛рдЪрд┐рдд рд╕рд░реНрд╡реЛрддреНрддрдо рдирд╕рд╛рд╡реА. рд▓рдХреНрд╖рд╛рдд рдареЗрд╡рд╛ рдХреА рдЖрдореНрд╣реА рд╕рд░реНрд╡реЛрддреНрддрдо рдХрд╛рдордЧрд┐рд░реА рдХрд░рдгрд╛рд░рд╛ Q-Table `Qbest` рд╡реНрд╣реЗрд░рд┐рдПрдмрд▓рдордзреНрдпреЗ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХреЗрд▓рд╛ рдЖрд╣реЗ! `Qbest` рд▓рд╛ `Q` рд╡рд░ рдХреЙрдкреА рдХрд░реВрди рд╕рд░реНрд╡реЛрддреНрддрдо рдХрд╛рдордЧрд┐рд░реА рдХрд░рдгрд╛рд▒реНрдпрд╛ Q-Table рд╕рд╣ рд╕рдорд╛рди рдЙрджрд╛рд╣рд░рдг рд╡рд╛рдкрд░реВрди рдкрд╣рд╛ рдЖрдгрд┐ рддреБрдореНрд╣рд╛рд▓рд╛ рдХрд╛рд╣реА рдлрд░рдХ рдЬрд╛рдгрд╡рддреЛ рдХрд╛ рддреЗ рдкрд╣рд╛.

> **рдХрд╛рд░реНрдп 4**: рдпреЗрдереЗ рдЖрдореНрд╣реА рдкреНрд░рддреНрдпреЗрдХ рдЪрд░рдгрд╛рд╡рд░ рд╕рд░реНрд╡реЛрддреНрддрдо рдХреГрддреА рдирд┐рд╡рдбрдд рдирд╡реНрд╣рддреЛ, рддрд░ рд╕рдВрдмрдВрдзрд┐рдд рд╕рдВрднрд╛рд╡реНрдпрддрд╛ рд╡рд┐рддрд░рдгрд╛рд╕рд╣ рдирдореБрдирд╛ рдШреЗрдд рд╣реЛрддреЛ. рдиреЗрд╣рдореАрдЪ рд╕рд░реНрд╡реЛрддреНрддрдо рдХреГрддреА рдирд┐рд╡рдбрдгреЗ рдЕрдзрд┐рдХ рдЕрд░реНрдердкреВрд░реНрдг рдард░реЗрд▓ рдХрд╛, рдЬреНрдпрд╛рдордзреНрдпреЗ Q-Table рдореВрд▓реНрдп рд╕рд░реНрд╡рд╛рдзрд┐рдХ рдЖрд╣реЗ? рд╣реЗ `np.argmax` рдлрдВрдХреНрд╢рди рд╡рд╛рдкрд░реВрди рдХрд░рддрд╛ рдпреЗрддреЗ, рдЬреЗ рдЙрдЪреНрдЪ Q-Table рдореВрд▓реНрдпрд╛рд╢реА рд╕рдВрдмрдВрдзрд┐рдд рдХреГрддреА рдХреНрд░рдорд╛рдВрдХ рд╢реЛрдзрддреЗ. рд╣реА рд░рдгрдиреАрддреА рдЕрдВрдорд▓рд╛рдд рдЖрдгрд╛ рдЖрдгрд┐ рд╕рдВрддреБрд▓рди рд╕реБрдзрд╛рд░рддреЗ рдХрд╛ рддреЗ рдкрд╣рд╛.

## [рд╡реНрдпрд╛рдЦреНрдпрд╛рдирд╛рдирдВрддрд░рдЪрд╛ рдХреНрд╡рд┐рдЭ](https://ff-quizzes.netlify.app/en/ml/)

## рдЕрд╕рд╛рдЗрдирдореЗрдВрдЯ
[рдорд╛рдЙрдВрдЯрди рдХрд╛рд░ рдкреНрд░рд╢рд┐рдХреНрд╖рд┐рдд рдХрд░рд╛](assignment.md)

## рдирд┐рд╖реНрдХрд░реНрд╖

рдЖрддрд╛ рдЖрдкрдг рдПрдЬрдВрдЯреНрд╕рдирд╛ рдлрдХреНрдд рдмрдХреНрд╖реАрд╕ рдлрдВрдХреНрд╢рди рдкреНрд░рджрд╛рди рдХрд░реВрди рдЪрд╛рдВрдЧрд▓реЗ рдкрд░рд┐рдгрд╛рдо рдорд┐рд│рд╡рдгреНрдпрд╛рд╕рд╛рдареА рдкреНрд░рд╢рд┐рдХреНрд╖рдг рджреЗрдгреЗ рд╢рд┐рдХрд▓реЗ рдЖрд╣реЗ, рдЬреЗ рдЦреЗрд│рд╛рдЪреНрдпрд╛ рдЗрдЪреНрдЫрд┐рдд рд╕реНрдерд┐рддреАрдЪреА рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХрд░рддреЗ, рдЖрдгрд┐ рддреНрдпрд╛рдВрдирд╛ рд╢реЛрдз рдЬрд╛рдЧрд╛ рдмреБрджреНрдзрд┐рдорддреНрддреЗрдиреЗ рдПрдХреНрд╕рдкреНрд▓реЛрд░ рдХрд░рдгреНрдпрд╛рдЪреА рд╕рдВрдзреА рджреЗрддреЗ. рдЖрдореНрд╣реА Q-Learning рдЕрд▓реНрдЧреЛрд░рд┐рджрдо рдпрд╢рд╕реНрд╡реАрд░рд┐рддреНрдпрд╛ рдбрд┐рд╕реНрдХреНрд░реАрдЯ рдЖрдгрд┐ рд╕рддрдд рд╡рд╛рддрд╛рд╡рд░рдгрд╛рдЪреНрдпрд╛ рдмрд╛рдмрддреАрдд рд▓рд╛рдЧреВ рдХреЗрд▓рд╛ рдЖрд╣реЗ, рдкрд░рдВрддреБ рдбрд┐рд╕реНрдХреНрд░реАрдЯ рдХреГрддреАрдВрд╕рд╣.

рдХреГрддреА рд╕реНрдерд┐рддреА рджреЗрдЦреАрд▓ рд╕рддрдд рдЕрд╕рддреЗ рдЖрдгрд┐ рдирд┐рд░реАрдХреНрд╖рдг рдЬрд╛рдЧрд╛ рдЦреВрдкрдЪ рдЬрдЯрд┐рд▓ рдЕрд╕рддреЗ рдЕрд╢рд╛ рдкрд░рд┐рд╕реНрдерд┐рддреАрдВрдЪрд╛ рдЕрднреНрдпрд╛рд╕ рдХрд░рдгреЗ рдорд╣рддреНрддреНрд╡рд╛рдЪреЗ рдЖрд╣реЗ, рдЬрд╕реЗ рдХреА рдЕрдЯрд╛рд░реА рдЧреЗрдо рд╕реНрдХреНрд░реАрдирд╡рд░реАрд▓ рдкреНрд░рддрд┐рдорд╛. рдЕрд╢рд╛ рд╕рдорд╕реНрдпрд╛рдВрдордзреНрдпреЗ рдЪрд╛рдВрдЧрд▓реЗ рдкрд░рд┐рдгрд╛рдо рдорд┐рд│рд╡рдгреНрдпрд╛рд╕рд╛рдареА рдЖрдкрд▓реНрдпрд╛рд▓рд╛ neural networks рд╕рд╛рд░рдЦреНрдпрд╛ рдЕрдзрд┐рдХ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рдорд╢реАрди рд▓рд░реНрдирд┐рдВрдЧ рддрдВрддреНрд░рд╛рдВрдЪрд╛ рд╡рд╛рдкрд░ рдХрд░рд╛рд╡рд╛ рд▓рд╛рдЧрддреЛ. рд╣реЗ рдЕрдзрд┐рдХ рдкреНрд░рдЧрдд рд╡рд┐рд╖рдп рдЖрдордЪреНрдпрд╛ рдЖрдЧрд╛рдореА рдкреНрд░рдЧрдд AI рдХреЛрд░реНрд╕рдЪрд╛ рд╡рд┐рд╖рдп рдЖрд╣реЗрдд.

---

**рдЕрд╕реНрд╡реАрдХрд░рдг**:  
рд╣рд╛ рджрд╕реНрддрдРрд╡рдЬ AI рднрд╛рд╖рд╛рдВрддрд░ рд╕реЗрд╡рд╛ [Co-op Translator](https://github.com/Azure/co-op-translator) рдЪрд╛ рд╡рд╛рдкрд░ рдХрд░реВрди рднрд╛рд╖рд╛рдВрддрд░рд┐рдд рдХрд░рдгреНрдпрд╛рдд рдЖрд▓рд╛ рдЖрд╣реЗ. рдЖрдореНрд╣реА рдЕрдЪреВрдХрддреЗрд╕рд╛рдареА рдкреНрд░рдпрддреНрдирд╢реАрд▓ рдЕрд╕рд▓реЛ рддрд░реА, рдХреГрдкрдпрд╛ рд▓рдХреНрд╖рд╛рдд рдШреНрдпрд╛ рдХреА рд╕реНрд╡рдпрдВрдЪрд▓рд┐рдд рднрд╛рд╖рд╛рдВрддрд░рд╛рдВрдордзреНрдпреЗ рддреНрд░реБрдЯреА рдХрд┐рдВрд╡рд╛ рдЕрдЪреВрдХрддреЗрдЪрд╛ рдЕрднрд╛рд╡ рдЕрд╕реВ рд╢рдХрддреЛ. рдореВрд│ рднрд╛рд╖реЗрддреАрд▓ рдореВрд│ рджрд╕реНрддрдРрд╡рдЬ рд╣рд╛ рдЕрдзрд┐рдХреГрдд рд╕реНрд░реЛрдд рдорд╛рдирд▓рд╛ рдЬрд╛рд╡рд╛. рдорд╣рддреНрддреНрд╡рд╛рдЪреНрдпрд╛ рдорд╛рд╣рд┐рддреАрд╕рд╛рдареА рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рдорд╛рдирд╡реА рднрд╛рд╖рд╛рдВрддрд░рд╛рдЪреА рд╢рд┐рдлрд╛рд░рд╕ рдХреЗрд▓реА рдЬрд╛рддреЗ. рдпрд╛ рднрд╛рд╖рд╛рдВрддрд░рд╛рдЪрд╛ рд╡рд╛рдкрд░ рдХреЗрд▓реНрдпрд╛рдореБрд│реЗ рдЙрджреНрднрд╡рдгрд╛рд▒реНрдпрд╛ рдХреЛрдгрддреНрдпрд╛рд╣реА рдЧреИрд░рд╕рдордЬ рдХрд┐рдВрд╡рд╛ рдЪреБрдХреАрдЪреНрдпрд╛ рдЕрд░реНрдерд╛рд╕рд╛рдареА рдЖрдореНрд╣реА рдЬрдмрд╛рдмрджрд╛рд░ рд░рд╛рд╣рдгрд╛рд░ рдирд╛рд╣реА.