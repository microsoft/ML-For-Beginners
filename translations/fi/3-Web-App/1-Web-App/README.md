<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "e0b75f73e4a90d45181dc5581fe2ef5c",
  "translation_date": "2025-09-05T00:39:06+00:00",
  "source_file": "3-Web-App/1-Web-App/README.md",
  "language_code": "fi"
}
-->
# Rakenna verkkosovellus ML-mallin kÃ¤yttÃ¶Ã¶n

TÃ¤ssÃ¤ oppitunnissa koulutat ML-mallin datajoukolla, joka on kirjaimellisesti "maailman ulkopuolelta": _UFO-havainnot viimeisen vuosisadan ajalta_, jotka on kerÃ¤tty NUFORC:n tietokannasta.

Opit:

- Kuinka 'pickle' koulutettu malli
- Kuinka kÃ¤yttÃ¤Ã¤ mallia Flask-sovelluksessa

Jatkamme muistikirjojen kÃ¤yttÃ¶Ã¤ datan puhdistamiseen ja mallin kouluttamiseen, mutta voit viedÃ¤ prosessin askeleen pidemmÃ¤lle tutkimalla mallin kÃ¤yttÃ¶Ã¤ "luonnossa", eli verkkosovelluksessa.

TÃ¤tÃ¤ varten sinun tÃ¤ytyy rakentaa verkkosovellus Flaskin avulla.

## [Ennakkokysely](https://ff-quizzes.netlify.app/en/ml/)

## Sovelluksen rakentaminen

On olemassa useita tapoja rakentaa verkkosovelluksia, jotka hyÃ¶dyntÃ¤vÃ¤t koneoppimismalleja. Verkkosovelluksen arkkitehtuuri voi vaikuttaa siihen, miten mallisi koulutetaan. Kuvittele, ettÃ¤ tyÃ¶skentelet yrityksessÃ¤, jossa data-analytiikkatiimi on kouluttanut mallin, jota he haluavat sinun kÃ¤yttÃ¤vÃ¤n sovelluksessa.

### Huomioitavat asiat

On monia kysymyksiÃ¤, joita sinun tÃ¤ytyy esittÃ¤Ã¤:

- **Onko kyseessÃ¤ verkkosovellus vai mobiilisovellus?** Jos rakennat mobiilisovellusta tai tarvitset mallin IoT-kontekstissa, voit kÃ¤yttÃ¤Ã¤ [TensorFlow Lite](https://www.tensorflow.org/lite/) ja hyÃ¶dyntÃ¤Ã¤ mallia Android- tai iOS-sovelluksessa.
- **MissÃ¤ malli sijaitsee?** PilvessÃ¤ vai paikallisesti?
- **Offline-tuki.** PitÃ¤Ã¤kÃ¶ sovelluksen toimia offline-tilassa?
- **MitÃ¤ teknologiaa kÃ¤ytettiin mallin kouluttamiseen?** Valittu teknologia voi vaikuttaa tarvittaviin tyÃ¶kaluihin.
    - **TensorFlowin kÃ¤yttÃ¶.** Jos koulutat mallin TensorFlowilla, kyseinen ekosysteemi tarjoaa mahdollisuuden muuntaa TensorFlow-malli verkkosovelluksessa kÃ¤ytettÃ¤vÃ¤ksi [TensorFlow.js](https://www.tensorflow.org/js/) avulla.
    - **PyTorchin kÃ¤yttÃ¶.** Jos rakennat mallin kirjastolla, kuten [PyTorch](https://pytorch.org/), voit viedÃ¤ sen [ONNX](https://onnx.ai/) (Open Neural Network Exchange) -muodossa JavaScript-verkkosovelluksiin, jotka voivat kÃ¤yttÃ¤Ã¤ [Onnx Runtime](https://www.onnxruntime.ai/). TÃ¤tÃ¤ vaihtoehtoa tutkitaan tulevassa oppitunnissa Scikit-learnilla koulutetulle mallille.
    - **Lobe.ai:n tai Azure Custom Visionin kÃ¤yttÃ¶.** Jos kÃ¤ytÃ¤t ML SaaS (Software as a Service) -jÃ¤rjestelmÃ¤Ã¤, kuten [Lobe.ai](https://lobe.ai/) tai [Azure Custom Vision](https://azure.microsoft.com/services/cognitive-services/custom-vision-service/?WT.mc_id=academic-77952-leestott), tÃ¤mÃ¤ntyyppinen ohjelmisto tarjoaa tapoja viedÃ¤ malli monille alustoille, mukaan lukien rÃ¤Ã¤tÃ¤lÃ¶idyn API:n rakentaminen, jota verkkosovelluksesi voi kysyÃ¤ pilvessÃ¤.

Sinulla on myÃ¶s mahdollisuus rakentaa kokonainen Flask-verkkosovellus, joka pystyy kouluttamaan mallin itse verkkoselaimessa. TÃ¤mÃ¤ voidaan tehdÃ¤ myÃ¶s TensorFlow.js:n avulla JavaScript-kontekstissa.

MeidÃ¤n tarkoituksiimme, koska olemme tyÃ¶skennelleet Python-pohjaisten muistikirjojen kanssa, tutkitaan vaiheita, joita tarvitaan koulutetun mallin viemiseksi muistikirjasta Pythonilla rakennetun verkkosovelluksen luettavaksi muodoksi.

## TyÃ¶kalut

TÃ¤tÃ¤ tehtÃ¤vÃ¤Ã¤ varten tarvitset kaksi tyÃ¶kalua: Flaskin ja Picklen, jotka molemmat toimivat Pythonilla.

âœ… MikÃ¤ on [Flask](https://palletsprojects.com/p/flask/)? Flaskin luojat mÃ¤Ã¤rittelevÃ¤t sen "mikro-kehykseksi", joka tarjoaa verkkokehysten perusominaisuudet Pythonilla ja mallinnusmoottorin verkkosivujen rakentamiseen. Tutustu [tÃ¤hÃ¤n oppimismoduuliin](https://docs.microsoft.com/learn/modules/python-flask-build-ai-web-app?WT.mc_id=academic-77952-leestott) harjoitellaksesi Flaskin kÃ¤yttÃ¶Ã¤.

âœ… MikÃ¤ on [Pickle](https://docs.python.org/3/library/pickle.html)? Pickle ðŸ¥’ on Python-moduuli, joka sarjoittaa ja desarjoittaa Python-objektirakenteita. Kun "picklaat" mallin, sarjoitat tai litistÃ¤t sen rakenteen verkkokÃ¤yttÃ¶Ã¤ varten. Ole varovainen: pickle ei ole luontaisesti turvallinen, joten ole varovainen, jos sinua pyydetÃ¤Ã¤n "un-picklaamaan" tiedosto. Picklattu tiedosto pÃ¤Ã¤ttyy `.pkl`.

## Harjoitus - puhdista datasi

TÃ¤ssÃ¤ oppitunnissa kÃ¤ytÃ¤t dataa 80 000 UFO-havainnosta, jotka on kerÃ¤tty [NUFORC](https://nuforc.org) (The National UFO Reporting Center) -organisaation toimesta. TÃ¤mÃ¤ data sisÃ¤ltÃ¤Ã¤ mielenkiintoisia kuvauksia UFO-havainnoista, esimerkiksi:

- **PitkÃ¤ esimerkkikuvaus.** "Mies astuu valonsÃ¤teestÃ¤, joka loistaa ruohokentÃ¤lle yÃ¶llÃ¤, ja juoksee kohti Texas Instrumentsin parkkipaikkaa."
- **Lyhyt esimerkkikuvaus.** "valot ajoivat meitÃ¤ takaa."

[ufos.csv](../../../../3-Web-App/1-Web-App/data/ufos.csv) -taulukko sisÃ¤ltÃ¤Ã¤ sarakkeita, jotka kertovat `kaupungin`, `osavaltion` ja `maan`, jossa havainto tapahtui, objektin `muodon` sekÃ¤ sen `leveysasteen` ja `pituusasteen`.

TyhjÃ¤Ã¤n [muistikirjaan](../../../../3-Web-App/1-Web-App/notebook.ipynb), joka sisÃ¤ltyy tÃ¤hÃ¤n oppituntiin:

1. tuo `pandas`, `matplotlib` ja `numpy` kuten teit aiemmissa oppitunneissa ja tuo UFO-taulukko. Voit tarkastella nÃ¤yte datajoukkoa:

    ```python
    import pandas as pd
    import numpy as np
    
    ufos = pd.read_csv('./data/ufos.csv')
    ufos.head()
    ```

1. Muunna UFO-data pieneksi datafreimiksi uusilla otsikoilla. Tarkista `Country`-kentÃ¤n uniikit arvot.

    ```python
    ufos = pd.DataFrame({'Seconds': ufos['duration (seconds)'], 'Country': ufos['country'],'Latitude': ufos['latitude'],'Longitude': ufos['longitude']})
    
    ufos.Country.unique()
    ```

1. Nyt voit vÃ¤hentÃ¤Ã¤ kÃ¤siteltÃ¤vÃ¤n datan mÃ¤Ã¤rÃ¤Ã¤ pudottamalla pois kaikki tyhjÃ¤t arvot ja tuomalla vain havainnot, jotka kestivÃ¤t 1-60 sekuntia:

    ```python
    ufos.dropna(inplace=True)
    
    ufos = ufos[(ufos['Seconds'] >= 1) & (ufos['Seconds'] <= 60)]
    
    ufos.info()
    ```

1. Tuo Scikit-learnin `LabelEncoder`-kirjasto muuntaaksesi maiden tekstiarvot numeroiksi:

    âœ… LabelEncoder koodaa datan aakkosjÃ¤rjestyksessÃ¤

    ```python
    from sklearn.preprocessing import LabelEncoder
    
    ufos['Country'] = LabelEncoder().fit_transform(ufos['Country'])
    
    ufos.head()
    ```

    Datasi pitÃ¤isi nÃ¤yttÃ¤Ã¤ tÃ¤ltÃ¤:

    ```output
    	Seconds	Country	Latitude	Longitude
    2	20.0	3		53.200000	-2.916667
    3	20.0	4		28.978333	-96.645833
    14	30.0	4		35.823889	-80.253611
    23	60.0	4		45.582778	-122.352222
    24	3.0		3		51.783333	-0.783333
    ```

## Harjoitus - rakenna mallisi

Nyt voit valmistautua kouluttamaan mallin jakamalla datan koulutus- ja testiryhmÃ¤Ã¤n.

1. Valitse kolme ominaisuutta, joilla haluat kouluttaa mallisi X-vektoriksi, ja y-vektori on `Country`. Haluat pystyÃ¤ syÃ¶ttÃ¤mÃ¤Ã¤n `Seconds`, `Latitude` ja `Longitude` ja saada maa-ID:n palautettavaksi.

    ```python
    from sklearn.model_selection import train_test_split
    
    Selected_features = ['Seconds','Latitude','Longitude']
    
    X = ufos[Selected_features]
    y = ufos['Country']
    
    X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=0)
    ```

1. Kouluta mallisi logistisella regressiolla:

    ```python
    from sklearn.metrics import accuracy_score, classification_report
    from sklearn.linear_model import LogisticRegression
    model = LogisticRegression()
    model.fit(X_train, y_train)
    predictions = model.predict(X_test)
    
    print(classification_report(y_test, predictions))
    print('Predicted labels: ', predictions)
    print('Accuracy: ', accuracy_score(y_test, predictions))
    ```

Tarkkuus ei ole huono **(noin 95%)**, mikÃ¤ ei ole yllÃ¤ttÃ¤vÃ¤Ã¤, koska `Country` ja `Latitude/Longitude` korreloivat.

Luomasi malli ei ole kovin vallankumouksellinen, koska `Country` voidaan pÃ¤Ã¤tellÃ¤ sen `Latitude` ja `Longitude` perusteella, mutta tÃ¤mÃ¤ on hyvÃ¤ harjoitus yrittÃ¤Ã¤ kouluttaa raakadataa, jonka puhdistit, viet ja sitten kÃ¤ytÃ¤t tÃ¤tÃ¤ mallia verkkosovelluksessa.

## Harjoitus - 'picklaa' mallisi

Nyt on aika _picklata_ mallisi! Voit tehdÃ¤ sen muutamalla koodirivillÃ¤. Kun malli on _picklattu_, lataa picklattu malli ja testaa sitÃ¤ nÃ¤yte datajoukolla, joka sisÃ¤ltÃ¤Ã¤ arvot sekunneille, leveysasteelle ja pituusasteelle.

```python
import pickle
model_filename = 'ufo-model.pkl'
pickle.dump(model, open(model_filename,'wb'))

model = pickle.load(open('ufo-model.pkl','rb'))
print(model.predict([[50,44,-12]]))
```

Malli palauttaa **'3'**, joka on Iso-Britannian maa-ID. Uskomatonta! ðŸ‘½

## Harjoitus - rakenna Flask-sovellus

Nyt voit rakentaa Flask-sovelluksen, joka kutsuu malliasi ja palauttaa samankaltaisia tuloksia, mutta visuaalisesti miellyttÃ¤vÃ¤mmÃ¤llÃ¤ tavalla.

1. Aloita luomalla kansio nimeltÃ¤ **web-app** _notebook.ipynb_-tiedoston viereen, jossa _ufo-model.pkl_-tiedosto sijaitsee.

1. Luo kyseiseen kansioon kolme muuta kansiota: **static**, jonka sisÃ¤llÃ¤ on kansio **css**, ja **templates**. Sinulla pitÃ¤isi nyt olla seuraavat tiedostot ja hakemistot:

    ```output
    web-app/
      static/
        css/
      templates/
    notebook.ipynb
    ufo-model.pkl
    ```

    âœ… Katso ratkaisukansiota nÃ¤hdÃ¤ksesi valmiin sovelluksen nÃ¤kymÃ¤n

1. EnsimmÃ¤inen tiedosto, joka luodaan _web-app_-kansioon, on **requirements.txt**-tiedosto. Kuten _package.json_ JavaScript-sovelluksessa, tÃ¤mÃ¤ tiedosto listaa sovelluksen tarvitsemat riippuvuudet. LisÃ¤Ã¤ **requirements.txt**-tiedostoon rivit:

    ```text
    scikit-learn
    pandas
    numpy
    flask
    ```

1. Nyt suorita tÃ¤mÃ¤ tiedosto siirtymÃ¤llÃ¤ _web-app_-kansioon:

    ```bash
    cd web-app
    ```

1. Kirjoita terminaaliin `pip install`, jotta asennat _requirements.txt_-tiedostossa listatut kirjastot:

    ```bash
    pip install -r requirements.txt
    ```

1. Nyt olet valmis luomaan kolme muuta tiedostoa sovelluksen viimeistelyÃ¤ varten:

    1. Luo **app.py** juureen.
    2. Luo **index.html** _templates_-hakemistoon.
    3. Luo **styles.css** _static/css_-hakemistoon.

1. TÃ¤ydennÃ¤ _styles.css_-tiedosto muutamalla tyylillÃ¤:

    ```css
    body {
    	width: 100%;
    	height: 100%;
    	font-family: 'Helvetica';
    	background: black;
    	color: #fff;
    	text-align: center;
    	letter-spacing: 1.4px;
    	font-size: 30px;
    }
    
    input {
    	min-width: 150px;
    }
    
    .grid {
    	width: 300px;
    	border: 1px solid #2d2d2d;
    	display: grid;
    	justify-content: center;
    	margin: 20px auto;
    }
    
    .box {
    	color: #fff;
    	background: #2d2d2d;
    	padding: 12px;
    	display: inline-block;
    }
    ```

1. Seuraavaksi tÃ¤ydennÃ¤ _index.html_-tiedosto:

    ```html
    <!DOCTYPE html>
    <html>
      <head>
        <meta charset="UTF-8">
        <title>ðŸ›¸ UFO Appearance Prediction! ðŸ‘½</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
      </head>
    
      <body>
        <div class="grid">
    
          <div class="box">
    
            <p>According to the number of seconds, latitude and longitude, which country is likely to have reported seeing a UFO?</p>
    
            <form action="{{ url_for('predict')}}" method="post">
              <input type="number" name="seconds" placeholder="Seconds" required="required" min="0" max="60" />
              <input type="text" name="latitude" placeholder="Latitude" required="required" />
              <input type="text" name="longitude" placeholder="Longitude" required="required" />
              <button type="submit" class="btn">Predict country where the UFO is seen</button>
            </form>
    
            <p>{{ prediction_text }}</p>
    
          </div>
    
        </div>
    
      </body>
    </html>
    ```

    Tarkastele tÃ¤mÃ¤n tiedoston mallinnusta. Huomaa 'viiksisyntaksi' muuttujien ympÃ¤rillÃ¤, jotka sovellus tarjoaa, kuten ennusteteksti: `{{}}`. SiellÃ¤ on myÃ¶s lomake, joka lÃ¤hettÃ¤Ã¤ ennusteen `/predict`-reitille.

    Lopuksi olet valmis rakentamaan Python-tiedoston, joka ohjaa mallin kÃ¤yttÃ¶Ã¤ ja ennusteiden nÃ¤yttÃ¤mistÃ¤:

1. LisÃ¤Ã¤ `app.py`-tiedostoon:

    ```python
    import numpy as np
    from flask import Flask, request, render_template
    import pickle
    
    app = Flask(__name__)
    
    model = pickle.load(open("./ufo-model.pkl", "rb"))
    
    
    @app.route("/")
    def home():
        return render_template("index.html")
    
    
    @app.route("/predict", methods=["POST"])
    def predict():
    
        int_features = [int(x) for x in request.form.values()]
        final_features = [np.array(int_features)]
        prediction = model.predict(final_features)
    
        output = prediction[0]
    
        countries = ["Australia", "Canada", "Germany", "UK", "US"]
    
        return render_template(
            "index.html", prediction_text="Likely country: {}".format(countries[output])
        )
    
    
    if __name__ == "__main__":
        app.run(debug=True)
    ```

    > ðŸ’¡ Vinkki: kun lisÃ¤Ã¤t [`debug=True`](https://www.askpython.com/python-modules/flask/flask-debug-mode) Flask-verkkosovellusta suorittaessasi, kaikki sovellukseen tekemÃ¤si muutokset nÃ¤kyvÃ¤t vÃ¤littÃ¶mÃ¤sti ilman, ettÃ¤ palvelinta tarvitsee kÃ¤ynnistÃ¤Ã¤ uudelleen. Ole varovainen! Ã„lÃ¤ ota tÃ¤tÃ¤ tilaa kÃ¤yttÃ¶Ã¶n tuotantosovelluksessa.

Jos suoritat `python app.py` tai `python3 app.py` - verkkopalvelimesi kÃ¤ynnistyy paikallisesti, ja voit tÃ¤yttÃ¤Ã¤ lyhyen lomakkeen saadaksesi vastauksen polttavaan kysymykseesi siitÃ¤, missÃ¤ UFO-havaintoja on tehty!

Ennen kuin teet sen, tarkastele `app.py`-tiedoston osia:

1. Ensin riippuvuudet ladataan ja sovellus kÃ¤ynnistyy.
1. Sitten malli tuodaan.
1. Sitten index.html renderÃ¶idÃ¤Ã¤n kotireitillÃ¤.

`/predict`-reitillÃ¤ tapahtuu useita asioita, kun lomake lÃ¤hetetÃ¤Ã¤n:

1. Lomakkeen muuttujat kerÃ¤tÃ¤Ã¤n ja muunnetaan numpy-taulukoksi. Ne lÃ¤hetetÃ¤Ã¤n mallille, ja ennuste palautetaan.
2. Maa, jonka haluamme nÃ¤yttÃ¤Ã¤, renderÃ¶idÃ¤Ã¤n uudelleen luettavana tekstinÃ¤ ennustetusta maa-ID:stÃ¤, ja tÃ¤mÃ¤ arvo lÃ¤hetetÃ¤Ã¤n takaisin index.html-tiedostoon, jotta se voidaan renderÃ¶idÃ¤ mallissa.

Mallin kÃ¤yttÃ¶ tÃ¤llÃ¤ tavalla, Flaskin ja picklatun mallin avulla, on suhteellisen suoraviivaista. Vaikeinta on ymmÃ¤rtÃ¤Ã¤, millaisessa muodossa datan tÃ¤ytyy olla, jotta se voidaan lÃ¤hettÃ¤Ã¤ mallille ennusteen saamiseksi. TÃ¤mÃ¤ riippuu tÃ¤ysin siitÃ¤, miten malli on koulutettu. TÃ¤ssÃ¤ mallissa tarvitaan kolme datakohtaa syÃ¶tettÃ¤vÃ¤ksi ennusteen saamiseksi.

Ammatillisessa ympÃ¤ristÃ¶ssÃ¤ nÃ¤et, kuinka hyvÃ¤ viestintÃ¤ on vÃ¤lttÃ¤mÃ¤tÃ¶ntÃ¤ niiden ihmisten vÃ¤lillÃ¤, jotka kouluttavat mallin, ja niiden, jotka kÃ¤yttÃ¤vÃ¤t sitÃ¤ verkkosovelluksessa tai mobiilisovelluksessa. MeidÃ¤n tapauksessamme kyseessÃ¤ on vain yksi henkilÃ¶, sinÃ¤!

---

## ðŸš€ Haaste

Sen sijaan, ettÃ¤ tyÃ¶skentelisit muistikirjassa ja toisit mallin Flask-sovellukseen, voisit kouluttaa mallin suoraan Flask-sovelluksessa! Kokeile muuntaa muistikirjan Python-koodi, ehkÃ¤ datan puhdistamisen jÃ¤lkeen, kouluttaaksesi mallin sovelluksen sisÃ¤llÃ¤ reitillÃ¤ nimeltÃ¤ `train`. MitkÃ¤ ovat tÃ¤mÃ¤n menetelmÃ¤n hyvÃ¤t ja huonot puolet?

## [JÃ¤lkikysely](https://ff-quizzes.netlify.app/en/ml/)

## Kertaus ja itseopiskelu

On monia tapoja rakentaa verkkosovellus, joka hyÃ¶dyntÃ¤Ã¤ ML-malleja. Tee lista tavoista, joilla voisit kÃ¤yttÃ¤Ã¤ JavaScriptiÃ¤ tai Pythonia rakentaaksesi verkkosovelluksen koneoppimisen hyÃ¶dyntÃ¤miseen. Mieti arkkitehtuuria: pitÃ¤isikÃ¶ mallin pysyÃ¤ sovelluksessa vai sijaita pilvessÃ¤? Jos jÃ¤lkimmÃ¤inen, miten pÃ¤Ã¤sisit siihen kÃ¤siksi? PiirrÃ¤ arkkitehtuurimalli sovelletulle ML-verkkoratkaisulle.

## TehtÃ¤vÃ¤

[Kokeile erilaista mallia](assignment.md)

---

**Vastuuvapauslauseke**:  
TÃ¤mÃ¤ asiakirja on kÃ¤Ã¤nnetty kÃ¤yttÃ¤mÃ¤llÃ¤ tekoÃ¤lypohjaista kÃ¤Ã¤nnÃ¶spalvelua [Co-op Translator](https://github.com/Azure/co-op-translator). Vaikka pyrimme tarkkuuteen, huomioithan, ettÃ¤ automaattiset kÃ¤Ã¤nnÃ¶kset voivat sisÃ¤ltÃ¤Ã¤ virheitÃ¤ tai epÃ¤tarkkuuksia. AlkuperÃ¤inen asiakirja sen alkuperÃ¤isellÃ¤ kielellÃ¤ tulisi pitÃ¤Ã¤ ensisijaisena lÃ¤hteenÃ¤. Kriittisen tiedon osalta suositellaan ammattimaista ihmiskÃ¤Ã¤nnÃ¶stÃ¤. Emme ole vastuussa vÃ¤Ã¤rinkÃ¤sityksistÃ¤ tai virhetulkinnoista, jotka johtuvat tÃ¤mÃ¤n kÃ¤Ã¤nnÃ¶ksen kÃ¤ytÃ¶stÃ¤.