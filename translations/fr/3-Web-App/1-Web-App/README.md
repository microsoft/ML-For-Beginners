<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "e0b75f73e4a90d45181dc5581fe2ef5c",
  "translation_date": "2025-09-04T23:01:48+00:00",
  "source_file": "3-Web-App/1-Web-App/README.md",
  "language_code": "fr"
}
-->
# Construire une application web pour utiliser un modÃ¨le de machine learning

Dans cette leÃ§on, vous allez entraÃ®ner un modÃ¨le de machine learning sur un ensemble de donnÃ©es hors du commun : _les observations d'OVNI au cours du siÃ¨cle dernier_, provenant de la base de donnÃ©es de NUFORC.

Vous apprendrez :

- Comment "pickle" un modÃ¨le entraÃ®nÃ©
- Comment utiliser ce modÃ¨le dans une application Flask

Nous continuerons Ã  utiliser des notebooks pour nettoyer les donnÃ©es et entraÃ®ner notre modÃ¨le, mais vous pouvez aller plus loin en explorant l'utilisation d'un modÃ¨le "dans la nature", pour ainsi dire : dans une application web.

Pour ce faire, vous devez construire une application web en utilisant Flask.

## [Quiz avant la leÃ§on](https://ff-quizzes.netlify.app/en/ml/)

## Construire une application

Il existe plusieurs faÃ§ons de crÃ©er des applications web pour consommer des modÃ¨les de machine learning. Votre architecture web peut influencer la maniÃ¨re dont votre modÃ¨le est entraÃ®nÃ©. Imaginez que vous travaillez dans une entreprise oÃ¹ le groupe de data science a entraÃ®nÃ© un modÃ¨le qu'il souhaite que vous utilisiez dans une application.

### Points Ã  considÃ©rer

Il y a de nombreuses questions Ã  se poser :

- **Est-ce une application web ou une application mobile ?** Si vous construisez une application mobile ou devez utiliser le modÃ¨le dans un contexte IoT, vous pourriez utiliser [TensorFlow Lite](https://www.tensorflow.org/lite/) et intÃ©grer le modÃ¨le dans une application Android ou iOS.
- **OÃ¹ le modÃ¨le sera-t-il hÃ©bergÃ© ?** Dans le cloud ou localement ?
- **Support hors ligne.** L'application doit-elle fonctionner hors ligne ?
- **Quelle technologie a Ã©tÃ© utilisÃ©e pour entraÃ®ner le modÃ¨le ?** La technologie choisie peut influencer les outils que vous devez utiliser.
    - **Utilisation de TensorFlow.** Si vous entraÃ®nez un modÃ¨le avec TensorFlow, par exemple, cet Ã©cosystÃ¨me permet de convertir un modÃ¨le TensorFlow pour une utilisation dans une application web via [TensorFlow.js](https://www.tensorflow.org/js/).
    - **Utilisation de PyTorch.** Si vous construisez un modÃ¨le avec une bibliothÃ¨que comme [PyTorch](https://pytorch.org/), vous avez la possibilitÃ© de l'exporter au format [ONNX](https://onnx.ai/) (Open Neural Network Exchange) pour une utilisation dans des applications web JavaScript qui peuvent utiliser le [Onnx Runtime](https://www.onnxruntime.ai/). Cette option sera explorÃ©e dans une future leÃ§on pour un modÃ¨le entraÃ®nÃ© avec Scikit-learn.
    - **Utilisation de Lobe.ai ou Azure Custom Vision.** Si vous utilisez un systÃ¨me ML SaaS (Software as a Service) tel que [Lobe.ai](https://lobe.ai/) ou [Azure Custom Vision](https://azure.microsoft.com/services/cognitive-services/custom-vision-service/?WT.mc_id=academic-77952-leestott) pour entraÃ®ner un modÃ¨le, ce type de logiciel offre des moyens d'exporter le modÃ¨le pour de nombreuses plateformes, y compris la crÃ©ation d'une API sur mesure Ã  interroger dans le cloud par votre application en ligne.

Vous avez Ã©galement la possibilitÃ© de construire une application web Flask complÃ¨te qui pourrait entraÃ®ner le modÃ¨le directement dans un navigateur web. Cela peut Ã©galement Ãªtre fait en utilisant TensorFlow.js dans un contexte JavaScript.

Pour nos besoins, puisque nous avons travaillÃ© avec des notebooks basÃ©s sur Python, explorons les Ã©tapes nÃ©cessaires pour exporter un modÃ¨le entraÃ®nÃ© depuis un notebook vers un format lisible par une application web construite en Python.

## Outils

Pour cette tÃ¢che, vous avez besoin de deux outils : Flask et Pickle, tous deux fonctionnant sur Python.

âœ… Qu'est-ce que [Flask](https://palletsprojects.com/p/flask/) ? DÃ©crit comme un "micro-framework" par ses crÃ©ateurs, Flask fournit les fonctionnalitÃ©s de base des frameworks web en utilisant Python et un moteur de templates pour construire des pages web. Consultez [ce module d'apprentissage](https://docs.microsoft.com/learn/modules/python-flask-build-ai-web-app?WT.mc_id=academic-77952-leestott) pour vous entraÃ®ner Ã  construire avec Flask.

âœ… Qu'est-ce que [Pickle](https://docs.python.org/3/library/pickle.html) ? Pickle ðŸ¥’ est un module Python qui sÃ©rialise et dÃ©sÃ©rialise une structure d'objet Python. Lorsque vous "pickle" un modÃ¨le, vous sÃ©rialisez ou aplatissez sa structure pour une utilisation sur le web. Attention : pickle n'est pas intrinsÃ¨quement sÃ©curisÃ©, soyez prudent si vous Ãªtes invitÃ© Ã  "un-pickle" un fichier. Un fichier picklÃ© a l'extension `.pkl`.

## Exercice - nettoyer vos donnÃ©es

Dans cette leÃ§on, vous utiliserez des donnÃ©es provenant de 80 000 observations d'OVNI, collectÃ©es par [NUFORC](https://nuforc.org) (The National UFO Reporting Center). Ces donnÃ©es contiennent des descriptions intÃ©ressantes d'observations d'OVNI, par exemple :

- **Description longue.** "Un homme Ã©merge d'un faisceau de lumiÃ¨re qui Ã©claire un champ herbeux la nuit et court vers le parking de Texas Instruments".
- **Description courte.** "les lumiÃ¨res nous ont poursuivis".

Le fichier [ufos.csv](../../../../3-Web-App/1-Web-App/data/ufos.csv) inclut des colonnes sur la `ville`, l'`Ã©tat` et le `pays` oÃ¹ l'observation a eu lieu, la `forme` de l'objet et ses `latitude` et `longitude`.

Dans le [notebook](../../../../3-Web-App/1-Web-App/notebook.ipynb) inclus dans cette leÃ§on :

1. Importez `pandas`, `matplotlib` et `numpy` comme vous l'avez fait dans les leÃ§ons prÃ©cÃ©dentes et importez le fichier ufos. Vous pouvez jeter un Å“il Ã  un Ã©chantillon de l'ensemble de donnÃ©es :

    ```python
    import pandas as pd
    import numpy as np
    
    ufos = pd.read_csv('./data/ufos.csv')
    ufos.head()
    ```

1. Convertissez les donnÃ©es ufos en un petit dataframe avec des titres actualisÃ©s. VÃ©rifiez les valeurs uniques dans le champ `Country`.

    ```python
    ufos = pd.DataFrame({'Seconds': ufos['duration (seconds)'], 'Country': ufos['country'],'Latitude': ufos['latitude'],'Longitude': ufos['longitude']})
    
    ufos.Country.unique()
    ```

1. RÃ©duisez maintenant la quantitÃ© de donnÃ©es Ã  traiter en supprimant les valeurs nulles et en n'important que les observations entre 1 et 60 secondes :

    ```python
    ufos.dropna(inplace=True)
    
    ufos = ufos[(ufos['Seconds'] >= 1) & (ufos['Seconds'] <= 60)]
    
    ufos.info()
    ```

1. Importez la bibliothÃ¨que `LabelEncoder` de Scikit-learn pour convertir les valeurs textuelles des pays en nombres :

    âœ… LabelEncoder encode les donnÃ©es par ordre alphabÃ©tique

    ```python
    from sklearn.preprocessing import LabelEncoder
    
    ufos['Country'] = LabelEncoder().fit_transform(ufos['Country'])
    
    ufos.head()
    ```

    Vos donnÃ©es devraient ressembler Ã  ceci :

    ```output
    	Seconds	Country	Latitude	Longitude
    2	20.0	3		53.200000	-2.916667
    3	20.0	4		28.978333	-96.645833
    14	30.0	4		35.823889	-80.253611
    23	60.0	4		45.582778	-122.352222
    24	3.0		3		51.783333	-0.783333
    ```

## Exercice - construire votre modÃ¨le

Vous pouvez maintenant prÃ©parer l'entraÃ®nement du modÃ¨le en divisant les donnÃ©es en groupes d'entraÃ®nement et de test.

1. SÃ©lectionnez les trois caractÃ©ristiques sur lesquelles vous souhaitez entraÃ®ner votre modÃ¨le comme vecteur X, et le vecteur y sera le `Country`. Vous voulez pouvoir entrer `Seconds`, `Latitude` et `Longitude` et obtenir un identifiant de pays en retour.

    ```python
    from sklearn.model_selection import train_test_split
    
    Selected_features = ['Seconds','Latitude','Longitude']
    
    X = ufos[Selected_features]
    y = ufos['Country']
    
    X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=0)
    ```

1. EntraÃ®nez votre modÃ¨le en utilisant la rÃ©gression logistique :

    ```python
    from sklearn.metrics import accuracy_score, classification_report
    from sklearn.linear_model import LogisticRegression
    model = LogisticRegression()
    model.fit(X_train, y_train)
    predictions = model.predict(X_test)
    
    print(classification_report(y_test, predictions))
    print('Predicted labels: ', predictions)
    print('Accuracy: ', accuracy_score(y_test, predictions))
    ```

La prÃ©cision n'est pas mauvaise **(environ 95%)**, ce qui n'est pas surprenant, car `Country` et `Latitude/Longitude` sont corrÃ©lÃ©s.

Le modÃ¨le que vous avez crÃ©Ã© n'est pas trÃ¨s rÃ©volutionnaire, car vous devriez Ãªtre capable d'infÃ©rer un `Country` Ã  partir de sa `Latitude` et `Longitude`, mais c'est un bon exercice pour essayer d'entraÃ®ner Ã  partir de donnÃ©es brutes que vous avez nettoyÃ©es, exportÃ©es, puis utiliser ce modÃ¨le dans une application web.

## Exercice - "pickle" votre modÃ¨le

Il est maintenant temps de _pickle_ votre modÃ¨le ! Vous pouvez le faire en quelques lignes de code. Une fois qu'il est _picklÃ©_, chargez votre modÃ¨le picklÃ© et testez-le avec un tableau de donnÃ©es contenant des valeurs pour les secondes, la latitude et la longitude.

```python
import pickle
model_filename = 'ufo-model.pkl'
pickle.dump(model, open(model_filename,'wb'))

model = pickle.load(open('ufo-model.pkl','rb'))
print(model.predict([[50,44,-12]]))
```

Le modÃ¨le retourne **'3'**, qui est le code pays pour le Royaume-Uni. Incroyable ! ðŸ‘½

## Exercice - construire une application Flask

Vous pouvez maintenant construire une application Flask pour appeler votre modÃ¨le et retourner des rÃ©sultats similaires, mais de maniÃ¨re plus visuellement agrÃ©able.

1. Commencez par crÃ©er un dossier appelÃ© **web-app** Ã  cÃ´tÃ© du fichier _notebook.ipynb_ oÃ¹ se trouve votre fichier _ufo-model.pkl_.

1. Dans ce dossier, crÃ©ez trois autres dossiers : **static**, avec un dossier **css** Ã  l'intÃ©rieur, et **templates**. Vous devriez maintenant avoir les fichiers et rÃ©pertoires suivants :

    ```output
    web-app/
      static/
        css/
      templates/
    notebook.ipynb
    ufo-model.pkl
    ```

    âœ… Consultez le dossier solution pour voir l'application terminÃ©e

1. Le premier fichier Ã  crÃ©er dans le dossier _web-app_ est le fichier **requirements.txt**. Comme _package.json_ dans une application JavaScript, ce fichier liste les dÃ©pendances nÃ©cessaires Ã  l'application. Dans **requirements.txt**, ajoutez les lignes :

    ```text
    scikit-learn
    pandas
    numpy
    flask
    ```

1. ExÃ©cutez maintenant ce fichier en naviguant vers _web-app_ :

    ```bash
    cd web-app
    ```

1. Dans votre terminal, tapez `pip install` pour installer les bibliothÃ¨ques listÃ©es dans _requirements.txt_ :

    ```bash
    pip install -r requirements.txt
    ```

1. Vous Ãªtes maintenant prÃªt Ã  crÃ©er trois autres fichiers pour terminer l'application :

    1. CrÃ©ez **app.py** Ã  la racine.
    2. CrÃ©ez **index.html** dans le rÃ©pertoire _templates_.
    3. CrÃ©ez **styles.css** dans le rÃ©pertoire _static/css_.

1. ComplÃ©tez le fichier _styles.css_ avec quelques styles :

    ```css
    body {
    	width: 100%;
    	height: 100%;
    	font-family: 'Helvetica';
    	background: black;
    	color: #fff;
    	text-align: center;
    	letter-spacing: 1.4px;
    	font-size: 30px;
    }
    
    input {
    	min-width: 150px;
    }
    
    .grid {
    	width: 300px;
    	border: 1px solid #2d2d2d;
    	display: grid;
    	justify-content: center;
    	margin: 20px auto;
    }
    
    .box {
    	color: #fff;
    	background: #2d2d2d;
    	padding: 12px;
    	display: inline-block;
    }
    ```

1. Ensuite, complÃ©tez le fichier _index.html_ :

    ```html
    <!DOCTYPE html>
    <html>
      <head>
        <meta charset="UTF-8">
        <title>ðŸ›¸ UFO Appearance Prediction! ðŸ‘½</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
      </head>
    
      <body>
        <div class="grid">
    
          <div class="box">
    
            <p>According to the number of seconds, latitude and longitude, which country is likely to have reported seeing a UFO?</p>
    
            <form action="{{ url_for('predict')}}" method="post">
              <input type="number" name="seconds" placeholder="Seconds" required="required" min="0" max="60" />
              <input type="text" name="latitude" placeholder="Latitude" required="required" />
              <input type="text" name="longitude" placeholder="Longitude" required="required" />
              <button type="submit" class="btn">Predict country where the UFO is seen</button>
            </form>
    
            <p>{{ prediction_text }}</p>
    
          </div>
    
        </div>
    
      </body>
    </html>
    ```

    Regardez le templating dans ce fichier. Notez la syntaxe "mustache" autour des variables qui seront fournies par l'application, comme le texte de prÃ©diction : `{{}}`. Il y a aussi un formulaire qui envoie une prÃ©diction Ã  la route `/predict`.

    Enfin, vous Ãªtes prÃªt Ã  construire le fichier Python qui pilote la consommation du modÃ¨le et l'affichage des prÃ©dictions :

1. Dans `app.py`, ajoutez :

    ```python
    import numpy as np
    from flask import Flask, request, render_template
    import pickle
    
    app = Flask(__name__)
    
    model = pickle.load(open("./ufo-model.pkl", "rb"))
    
    
    @app.route("/")
    def home():
        return render_template("index.html")
    
    
    @app.route("/predict", methods=["POST"])
    def predict():
    
        int_features = [int(x) for x in request.form.values()]
        final_features = [np.array(int_features)]
        prediction = model.predict(final_features)
    
        output = prediction[0]
    
        countries = ["Australia", "Canada", "Germany", "UK", "US"]
    
        return render_template(
            "index.html", prediction_text="Likely country: {}".format(countries[output])
        )
    
    
    if __name__ == "__main__":
        app.run(debug=True)
    ```

    > ðŸ’¡ Astuce : lorsque vous ajoutez [`debug=True`](https://www.askpython.com/python-modules/flask/flask-debug-mode) en exÃ©cutant l'application web avec Flask, tout changement que vous apportez Ã  votre application sera immÃ©diatement reflÃ©tÃ© sans avoir besoin de redÃ©marrer le serveur. Attention ! Ne pas activer ce mode dans une application en production.

Si vous exÃ©cutez `python app.py` ou `python3 app.py`, votre serveur web dÃ©marre localement, et vous pouvez remplir un court formulaire pour obtenir une rÃ©ponse Ã  votre question brÃ»lante sur les lieux oÃ¹ les OVNI ont Ã©tÃ© observÃ©s !

Avant de faire cela, examinez les parties de `app.py` :

1. Tout d'abord, les dÃ©pendances sont chargÃ©es et l'application dÃ©marre.
1. Ensuite, le modÃ¨le est importÃ©.
1. Enfin, index.html est rendu sur la route d'accueil.

Sur la route `/predict`, plusieurs choses se produisent lorsque le formulaire est envoyÃ© :

1. Les variables du formulaire sont collectÃ©es et converties en un tableau numpy. Elles sont ensuite envoyÃ©es au modÃ¨le et une prÃ©diction est retournÃ©e.
2. Les pays que nous voulons afficher sont re-rendus sous forme de texte lisible Ã  partir de leur code pays prÃ©dit, et cette valeur est renvoyÃ©e Ã  index.html pour Ãªtre rendue dans le template.

Utiliser un modÃ¨le de cette maniÃ¨re, avec Flask et un modÃ¨le picklÃ©, est relativement simple. La partie la plus difficile est de comprendre la forme des donnÃ©es qui doivent Ãªtre envoyÃ©es au modÃ¨le pour obtenir une prÃ©diction. Tout dÃ©pend de la maniÃ¨re dont le modÃ¨le a Ã©tÃ© entraÃ®nÃ©. Celui-ci nÃ©cessite trois points de donnÃ©es pour obtenir une prÃ©diction.

Dans un cadre professionnel, vous pouvez voir Ã  quel point une bonne communication est nÃ©cessaire entre les personnes qui entraÃ®nent le modÃ¨le et celles qui le consomment dans une application web ou mobile. Dans notre cas, c'est une seule personne : vous !

---

## ðŸš€ DÃ©fi

Au lieu de travailler dans un notebook et d'importer le modÃ¨le dans l'application Flask, vous pourriez entraÃ®ner le modÃ¨le directement dans l'application Flask ! Essayez de convertir votre code Python dans le notebook, peut-Ãªtre aprÃ¨s avoir nettoyÃ© vos donnÃ©es, pour entraÃ®ner le modÃ¨le directement dans l'application sur une route appelÃ©e `train`. Quels sont les avantages et les inconvÃ©nients de cette mÃ©thode ?

## [Quiz aprÃ¨s la leÃ§on](https://ff-quizzes.netlify.app/en/ml/)

## RÃ©vision et auto-apprentissage

Il existe de nombreuses faÃ§ons de construire une application web pour consommer des modÃ¨les de machine learning. Faites une liste des faÃ§ons dont vous pourriez utiliser JavaScript ou Python pour construire une application web exploitant le machine learning. Pensez Ã  l'architecture : le modÃ¨le doit-il rester dans l'application ou vivre dans le cloud ? Si c'est le cas, comment y accÃ©der ? Dessinez un modÃ¨le architectural pour une solution web appliquÃ©e au machine learning.

## Devoir

[Essayez un modÃ¨le diffÃ©rent](assignment.md)

---

**Avertissement** :  
Ce document a Ã©tÃ© traduit Ã  l'aide du service de traduction automatique [Co-op Translator](https://github.com/Azure/co-op-translator). Bien que nous nous efforcions d'assurer l'exactitude, veuillez noter que les traductions automatisÃ©es peuvent contenir des erreurs ou des inexactitudes. Le document original dans sa langue d'origine doit Ãªtre considÃ©rÃ© comme la source faisant autoritÃ©. Pour des informations critiques, il est recommandÃ© de recourir Ã  une traduction professionnelle rÃ©alisÃ©e par un humain. Nous dÃ©clinons toute responsabilitÃ© en cas de malentendus ou d'interprÃ©tations erronÃ©es rÃ©sultant de l'utilisation de cette traduction.